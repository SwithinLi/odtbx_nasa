<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><link rel="stylesheet" href="file:///C:\Program Files\MATLAB\R2008a\toolbox\matlab\codetools\matlab-report-styles.css" type="text/css" /><title>Function details for gpsmeas</title><link rel="stylesheet" href="file:///C:\Program Files\MATLAB\R2008a\toolbox\matlab\codetools\matlab-report-styles.css" type="text/css" /></head><body bgcolor="#F8F8F8"><strong>This is a static copy of a profile report</strong><p><a href="file0.html">Home</a><p><span style="font-size:14pt; background:#FFE4B0">gpsmeas (721 calls, 72.219 sec)</span><br/><i>Generated 29-May-2009 14:20:37 using cpu time.</i><br/>M-function in file C:\Users\abrown\Projects\ODTBX\matlab\trunk\ODTBX_Source\gpsmeas.m<br/>[Copy to new window for comparing multiple runs]<div class="grayline"/><div class="grayline"/><strong>Parents</strong> (calling functions)<br/><p><table border=0 cellspacing=0 cellpadding=6><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Function Name</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Function Type</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Calls</td></tr><tr><td class="td-linebottomrt"><a href="file5.html">gpsmeas_sequential_fortiming</a></td><td class="td-linebottomrt">M-script</td><td class="td-linebottomrt">721</td></tr></table><div class="grayline"/><strong>Lines where the most time was spent</strong><br/> <p><table border=0 cellspacing=0 cellpadding=6><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Line Number</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Code</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Calls</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Total Time</td><td class="td-linebottomrt" bgcolor="#F0F0F0">% Time</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Time Plot</td></tr><tr><td class="td-linebottomrt"><a href="#Line277">277</a></td><td class="td-linebottomrt"><pre>[gps_alm] = read_yuma(YumaFile...</pre></td><td class="td-linebottomrt">721</td><td class="td-linebottomrt">20.433 s</td><td class="td-linebottomrt" class="td-linebottomrt">28.3%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2008a\toolbox\matlab\codetools\private\one-pixel.gif" width=28 height=10></td></tr><tr><td class="td-linebottomrt"><a href="#Line539">539</a></td><td class="td-linebottomrt"><pre>los_ned = ecef2NED(Hulos',sat_...</pre></td><td class="td-linebottomrt">46144</td><td class="td-linebottomrt">13.880 s</td><td class="td-linebottomrt" class="td-linebottomrt">19.2%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2008a\toolbox\matlab\codetools\private\one-pixel.gif" width=19 height=10></td></tr><tr><td class="td-linebottomrt"><a href="#Line590">590</a></td><td class="td-linebottomrt"><pre>Vzero=union(find(VISCN0(n,:)==...</pre></td><td class="td-linebottomrt">138432</td><td class="td-linebottomrt">7.878 s</td><td class="td-linebottomrt" class="td-linebottomrt">10.9%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2008a\toolbox\matlab\codetools\private\one-pixel.gif" width=11 height=10></td></tr><tr><td class="td-linebottomrt"><a href="#Line635">635</a></td><td class="td-linebottomrt"><pre>Hvr = shiftdim(dv.*repmat(1./r...</pre></td><td class="td-linebottomrt">23072</td><td class="td-linebottomrt">2.863 s</td><td class="td-linebottomrt" class="td-linebottomrt">4.0%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2008a\toolbox\matlab\codetools\private\one-pixel.gif" width=4 height=10></td></tr><tr><td class="td-linebottomrt"><a href="#Line261">261</a></td><td class="td-linebottomrt"><pre>init2fixed  = jatDCM('eci2ecef...</pre></td><td class="td-linebottomrt">721</td><td class="td-linebottomrt">2.118 s</td><td class="td-linebottomrt" class="td-linebottomrt">2.9%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2008a\toolbox\matlab\codetools\private\one-pixel.gif" width=3 height=10></td></tr><tr><td class="td-linebottomrt">All other lines</td><td class="td-linebottomrt">&nbsp;</td><td class="td-linebottomrt">&nbsp;</td><td class="td-linebottomrt">25.048 s</td><td class="td-linebottomrt">34.7%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2008a\toolbox\matlab\codetools\private\one-pixel.gif" width=35 height=10></td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Totals</td><td class="td-linebottomrt" bgcolor="#F0F0F0">&nbsp;</td><td class="td-linebottomrt" bgcolor="#F0F0F0">&nbsp;</td><td class="td-linebottomrt" bgcolor="#F0F0F0">72.219 s</td><td class="td-linebottomrt" bgcolor="#F0F0F0">100%</td><td class="td-linebottomrt" bgcolor="#F0F0F0">&nbsp;</td></tr></table><div class="grayline"/><b>Children</b> (called functions)<br/><p><table border=0 cellspacing=0 cellpadding=6><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Function Name</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Function Type</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Calls</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Total Time</td><td class="td-linebottomrt" bgcolor="#F0F0F0">% Time</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Time Plot</td></tr><tr><td class="td-linebottomrt"><a href="file24.html">read_yuma</a></td><td class="td-linebottomrt">M-function</td><td class="td-linebottomrt">721</td><td class="td-linebottomrt">20.423 s</td><td class="td-linebottomrt">28.3%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2008a\toolbox\matlab\codetools\private\one-pixel.gif" width=28 height=10></td></tr><tr><td class="td-linebottomrt"><a href="file39.html">ecef2NED</a></td><td class="td-linebottomrt">M-function</td><td class="td-linebottomrt">46144</td><td class="td-linebottomrt">13.417 s</td><td class="td-linebottomrt">18.6%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2008a\toolbox\matlab\codetools\private\one-pixel.gif" width=19 height=10></td></tr><tr><td class="td-linebottomrt"><a href="file67.html">union</a></td><td class="td-linebottomrt">M-function</td><td class="td-linebottomrt">138432</td><td class="td-linebottomrt">7.221 s</td><td class="td-linebottomrt">10.0%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2008a\toolbox\matlab\codetools\private\one-pixel.gif" width=10 height=10></td></tr><tr><td class="td-linebottomrt"><a href="file62.html">interp1</a></td><td class="td-linebottomrt">M-function</td><td class="td-linebottomrt">2884</td><td class="td-linebottomrt">3.251 s</td><td class="td-linebottomrt">4.5%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2008a\toolbox\matlab\codetools\private\one-pixel.gif" width=5 height=10></td></tr><tr><td class="td-linebottomrt"><a href="file29.html">getOdtbxOptions</a></td><td class="td-linebottomrt">M-function</td><td class="td-linebottomrt">18025</td><td class="td-linebottomrt">2.767 s</td><td class="td-linebottomrt">3.8%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2008a\toolbox\matlab\codetools\private\one-pixel.gif" width=4 height=10></td></tr><tr><td class="td-linebottomrt"><a href="file31.html">jatDCM</a></td><td class="td-linebottomrt">M-function</td><td class="td-linebottomrt">721</td><td class="td-linebottomrt">2.111 s</td><td class="td-linebottomrt">2.9%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2008a\toolbox\matlab\codetools\private\one-pixel.gif" width=3 height=10></td></tr><tr><td class="td-linebottomrt"><a href="file70.html">shiftdim</a></td><td class="td-linebottomrt">M-function</td><td class="td-linebottomrt">69216</td><td class="td-linebottomrt">1.760 s</td><td class="td-linebottomrt">2.4%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2008a\toolbox\matlab\codetools\private\one-pixel.gif" width=2 height=10></td></tr><tr><td class="td-linebottomrt"><a href="file52.html">dot</a></td><td class="td-linebottomrt">M-function</td><td class="td-linebottomrt">72100</td><td class="td-linebottomrt">1.572 s</td><td class="td-linebottomrt">2.2%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2008a\toolbox\matlab\codetools\private\one-pixel.gif" width=2 height=10></td></tr><tr><td class="td-linebottomrt"><a href="file40.html">repmat</a></td><td class="td-linebottomrt">M-function</td><td class="td-linebottomrt">47586</td><td class="td-linebottomrt">1.418 s</td><td class="td-linebottomrt">2.0%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2008a\toolbox\matlab\codetools\private\one-pixel.gif" width=2 height=10></td></tr><tr><td class="td-linebottomrt"><a href="file23.html">convertTime</a></td><td class="td-linebottomrt">M-function</td><td class="td-linebottomrt">721</td><td class="td-linebottomrt">1.317 s</td><td class="td-linebottomrt">1.8%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2008a\toolbox\matlab\codetools\private\one-pixel.gif" width=2 height=10></td></tr><tr><td class="td-linebottomrt"><a href="file63.html">num2str</a></td><td class="td-linebottomrt">M-function</td><td class="td-linebottomrt">12978</td><td class="td-linebottomrt">0.916 s</td><td class="td-linebottomrt">1.3%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2008a\toolbox\matlab\codetools\private\one-pixel.gif" width=1 height=10></td></tr><tr><td class="td-linebottomrt"><a href="file19.html">datenum</a></td><td class="td-linebottomrt">M-function</td><td class="td-linebottomrt">721</td><td class="td-linebottomrt">0.848 s</td><td class="td-linebottomrt">1.2%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2008a\toolbox\matlab\codetools\private\one-pixel.gif" width=1 height=10></td></tr><tr><td class="td-linebottomrt"><a href="file7.html">cell.union</a></td><td class="td-linebottomrt">M-function</td><td class="td-linebottomrt">2884</td><td class="td-linebottomrt">0.727 s</td><td class="td-linebottomrt">1.0%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2008a\toolbox\matlab\codetools\private\one-pixel.gif" width=1 height=10></td></tr><tr><td class="td-linebottomrt"><a href="file30.html">JATConstant</a></td><td class="td-linebottomrt">M-function</td><td class="td-linebottomrt">2163</td><td class="td-linebottomrt">0.646 s</td><td class="td-linebottomrt">0.9%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2008a\toolbox\matlab\codetools\private\one-pixel.gif" width=1 height=10></td></tr><tr><td class="td-linebottomrt"><a href="file69.html">unit</a></td><td class="td-linebottomrt">M-function</td><td class="td-linebottomrt">23072</td><td class="td-linebottomrt">0.476 s</td><td class="td-linebottomrt">0.7%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2008a\toolbox\matlab\codetools\private\one-pixel.gif" width=1 height=10></td></tr><tr><td class="td-linebottomrt"><a href="file50.html">alm2xyz</a></td><td class="td-linebottomrt">M-function</td><td class="td-linebottomrt">721</td><td class="td-linebottomrt">0.296 s</td><td class="td-linebottomrt">0.4%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2008a\toolbox\matlab\codetools\private\one-pixel.gif" width=0 height=10></td></tr><tr><td class="td-linebottomrt"><a href="file65.html">ecef2LLA</a></td><td class="td-linebottomrt">M-function</td><td class="td-linebottomrt">1442</td><td class="td-linebottomrt">0.284 s</td><td class="td-linebottomrt">0.4%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2008a\toolbox\matlab\codetools\private\one-pixel.gif" width=0 height=10></td></tr><tr><td class="td-linebottomrt"><a href="file41.html">rotransf</a></td><td class="td-linebottomrt">M-function</td><td class="td-linebottomrt">721</td><td class="td-linebottomrt">0.069 s</td><td class="td-linebottomrt">0.1%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2008a\toolbox\matlab\codetools\private\one-pixel.gif" width=0 height=10></td></tr><tr><td class="td-linebottomrt"><a href="file51.html">comp_bs_3d</a></td><td class="td-linebottomrt">M-function</td><td class="td-linebottomrt">721</td><td class="td-linebottomrt">0.057 s</td><td class="td-linebottomrt">0.1%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2008a\toolbox\matlab\codetools\private\one-pixel.gif" width=0 height=10></td></tr><tr><td class="td-linebottomrt"><a href="file53.html">log10</a></td><td class="td-linebottomrt">M-function</td><td class="td-linebottomrt">2884</td><td class="td-linebottomrt">0.034 s</td><td class="td-linebottomrt">0.0%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2008a\toolbox\matlab\codetools\private\one-pixel.gif" width=0 height=10></td></tr><tr><td class="td-linebottomrt"><a href="file43.html">gpsmeas>IdentRot</a></td><td class="td-linebottomrt">M-subfunction</td><td class="td-linebottomrt">721</td><td class="td-linebottomrt">0.008 s</td><td class="td-linebottomrt">0.0%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2008a\toolbox\matlab\codetools\private\one-pixel.gif" width=0 height=10></td></tr><tr><td class="td-linebottomrt">Self time (built-ins, overhead, etc.)</td><td class="td-linebottomrt">&nbsp;</td><td class="td-linebottomrt">&nbsp;</td><td class="td-linebottomrt">12.601 s</td><td class="td-linebottomrt">17.4%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2008a\toolbox\matlab\codetools\private\one-pixel.gif" width=17 height=10></td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Totals</td><td class="td-linebottomrt" bgcolor="#F0F0F0">&nbsp;</td><td class="td-linebottomrt" bgcolor="#F0F0F0">&nbsp;</td><td class="td-linebottomrt" bgcolor="#F0F0F0">72.219 s</td><td class="td-linebottomrt" bgcolor="#F0F0F0">100%</td><td class="td-linebottomrt" bgcolor="#F0F0F0">&nbsp;</td></tr></table><div class="grayline"/><strong>M-Lint results</strong><br/><table border=0 cellspacing=0 cellpadding=6><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Line number</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Message</td></tr><tr><td class="td-linebottomrt"><a href="#Line266">266</a></td><td class="td-linebottomrt"><span class="mono">'sat_pos' might be growing inside a loop. Consider preallocating for speed.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line267">267</a></td><td class="td-linebottomrt"><span class="mono">'sat_vel' might be growing inside a loop. Consider preallocating for speed.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line281">281</a></td><td class="td-linebottomrt"><span class="mono">Logical indexing is usually faster than FIND.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line290">290</a></td><td class="td-linebottomrt"><span class="mono">Logical indexing is usually faster than FIND.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line301">301</a></td><td class="td-linebottomrt"><span class="mono">Use of brackets [] is unnecessary.  Use parentheses to group, if needed.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line303">303</a></td><td class="td-linebottomrt"><span class="mono">The value assigned here to variable 'vgps_mag' might never be used.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line306">306</a></td><td class="td-linebottomrt"><span class="mono">The value assigned here to variable 'ruser_unit' might never be used.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line320">320</a></td><td class="td-linebottomrt"><span class="mono">The value assigned here to variable 'rgps_mag_3d' might never be used.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line320">320</a></td><td class="td-linebottomrt"><span class="mono">'rgps_mag_3d' might be growing inside a loop. Consider preallocating for speed.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line328">328</a></td><td class="td-linebottomrt"><span class="mono">Logical indexing is usually faster than FIND.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line341">341</a></td><td class="td-linebottomrt"><span class="mono">Logical indexing is usually faster than FIND.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line354">354</a></td><td class="td-linebottomrt"><span class="mono">The value assigned here to variable 'Hvis_atm' might never be used.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line355">355</a></td><td class="td-linebottomrt"><span class="mono">The value assigned here to variable 'HSVazi' might never be used.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line358">358</a></td><td class="td-linebottomrt"><span class="mono">Use of brackets [] is unnecessary.  Use parentheses to group, if needed.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line456">456</a></td><td class="td-linebottomrt"><span class="mono">The value assigned here to variable 'S' might never be used.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line494">494</a></td><td class="td-linebottomrt"><span class="mono">'variable_str' might be growing inside a loop. Consider preallocating for speed.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line501">501</a></td><td class="td-linebottomrt"><span class="mono">The value assigned here to variable 'HVISdyn' might never be used.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line503">503</a></td><td class="td-linebottomrt"><span class="mono">The value assigned here to variable 'betar_gss' might never be used.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line564">564</a></td><td class="td-linebottomrt"><span class="mono">The value assigned here to variable 'CN0_lim_dyn' might never be used.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line575">575</a></td><td class="td-linebottomrt"><span class="mono">The value assigned here to variable 'HVIScases' might never be used.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line608">608</a></td><td class="td-linebottomrt"><span class="mono">The value assigned here to variable 'HRR' might never be used.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line611">611</a></td><td class="td-linebottomrt"><span class="mono">The value assigned here to variable 'HCN0' might never be used.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line612">612</a></td><td class="td-linebottomrt"><span class="mono">The value assigned here to variable 'HRP' might never be used.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line622">622</a></td><td class="td-linebottomrt"><span class="mono">'y' might be growing inside a loop. Consider preallocating for speed.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line625">625</a></td><td class="td-linebottomrt"><span class="mono">'y' might be growing inside a loop. Consider preallocating for speed.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line639">639</a></td><td class="td-linebottomrt"><span class="mono">'H' might be growing inside a loop. Consider preallocating for speed.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line642">642</a></td><td class="td-linebottomrt"><span class="mono">'H' might be growing inside a loop. Consider preallocating for speed.</span></td></tr></table><div class="grayline"/><strong>Coverage results</strong><br/>[ Show coverage for parent directory ]<br/><table border=0 cellspacing=0 cellpadding=6><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Total lines in function</td><td class="td-linebottomrt">650</td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Non-code lines (comments, blank lines)</td><td class="td-linebottomrt">343</td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Code lines (lines that can run)</td><td class="td-linebottomrt">307</td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Code lines that did run</td><td class="td-linebottomrt">267</td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Code lines that did not run</td><td class="td-linebottomrt">40</td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Coverage (did run/can run)</td><td class="td-linebottomrt">86.97 %</td></tr></table><div class="grayline"/><b>Function listing</b><br/><pre> <span style="color: #FF0000; font-weight: bold; text-decoration: none">  time</span> <span style="color: #0000FF; font-weight: bold; text-decoration: none">  calls</span>  <span style="font-weight: bold; text-decoration: none">line</span><br/>               <span style="color: #A0A0A0">   1</span> <span style="color: #A0A0A0; background: #FFFFFF;">function [y,H,R] = gpsmeas(t,x,options)</span><br/>               <span style="color: #A0A0A0">   2</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0">   3</span> <span style="color: #228B22; background: #FFFFFF;">% GPSMEAS  Makes GPS based measurements using dynamic C/No tracking threshold</span><br/>               <span style="color: #A0A0A0">   4</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">   5</span> <span style="color: #228B22; background: #FFFFFF;">%   [y,H,R] = GSMEAS(t,x,options) creates GPS measurements based on the </span><br/>               <span style="color: #A0A0A0">   6</span> <span style="color: #228B22; background: #FFFFFF;">% information in OPTIONS. The measurement types that can be returned are</span><br/>               <span style="color: #A0A0A0">   7</span> <span style="color: #228B22; background: #FFFFFF;">% RANGE and DOPPLER. See the OD Toolbox function of the same name for </span><br/>               <span style="color: #A0A0A0">   8</span> <span style="color: #228B22; background: #FFFFFF;">% details of each measurement type.</span><br/>               <span style="color: #A0A0A0">   9</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">  10</span> <span style="color: #228B22; background: #FFFFFF;">% OPTIONS is an OD Toolbox Measurement Options data structure. See</span><br/>               <span style="color: #A0A0A0">  11</span> <span style="color: #228B22; background: #FFFFFF;">% ODTBXOPTIONS for all available options settings. The options parameters</span><br/>               <span style="color: #A0A0A0">  12</span> <span style="color: #228B22; background: #FFFFFF;">% that are valid for this function are:</span><br/>               <span style="color: #A0A0A0">  13</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">  14</span> <span style="color: #228B22; background: #FFFFFF;">%   PARAMETER           VALID VALUES           NOTES</span><br/>               <span style="color: #A0A0A0">  15</span> <span style="color: #228B22; background: #FFFFFF;">%   epoch               datenum                Time associated with start of simulation</span><br/>               <span style="color: #A0A0A0">  16</span> <span style="color: #228B22; background: #FFFFFF;">%   useRange            {true(default), false} Return range measurement</span><br/>               <span style="color: #A0A0A0">  17</span> <span style="color: #228B22; background: #FFFFFF;">%   useDoppler          {true, false(default)} Return doppler measurement</span><br/>               <span style="color: #A0A0A0">  18</span> <span style="color: #228B22; background: #FFFFFF;">%   rSigma                                     Measurement covariance</span><br/>               <span style="color: #A0A0A0">  19</span> <span style="color: #228B22; background: #FFFFFF;">%   GPSBand             {'L1'(default), 'L2'}  L-band carrier</span><br/>               <span style="color: #A0A0A0">  20</span> <span style="color: #228B22; background: #FFFFFF;">%   YumaFile            filename               GPS almanac file</span><br/>               <span style="color: #A0A0A0">  21</span> <span style="color: #228B22; background: #FFFFFF;">%   Rotation2ECI        @functionname          For coordinate frames other than ECI. This value allows</span><br/>               <span style="color: #A0A0A0">  22</span> <span style="color: #228B22; background: #FFFFFF;">%                                              the user to have x in any coordinate frame as long as the</span><br/>               <span style="color: #A0A0A0">  23</span> <span style="color: #228B22; background: #FFFFFF;">%                                              rotation to ECI goes with it. Input must be a pointer to a</span><br/>               <span style="color: #A0A0A0">  24</span> <span style="color: #228B22; background: #FFFFFF;">%                                              rotation function with time as the input. (6x6 matrix)</span><br/>               <span style="color: #A0A0A0">  25</span> <span style="color: #228B22; background: #FFFFFF;">%   AntennaPointing     1 x num_ant            Specify attitude profile for each antenna</span><br/>               <span style="color: #A0A0A0">  26</span> <span style="color: #228B22; background: #FFFFFF;">%                                              (1) zenith pointing or (-1) nadir pointing wrt geocentric LVLH</span><br/>               <span style="color: #A0A0A0">  27</span> <span style="color: #228B22; background: #FFFFFF;">%                                              (2) parallel or (-2) antiparallel to the Earth-Sun vector</span><br/>               <span style="color: #A0A0A0">  28</span> <span style="color: #228B22; background: #FFFFFF;">%                                              (3) ecliptic north or south (-3)</span><br/>               <span style="color: #A0A0A0">  29</span> <span style="color: #228B22; background: #FFFFFF;">%                                              (4) fixed with respect to apogee zenith, or (-4) nadir vector apogee </span><br/>               <span style="color: #A0A0A0">  30</span> <span style="color: #228B22; background: #FFFFFF;">%                                                selected as the point of highest altitude (ephemeris must include apogee)</span><br/>               <span style="color: #A0A0A0">  31</span> <span style="color: #228B22; background: #FFFFFF;">%                                              (5) body fore and (-5) aft directions relative to geocentric LVLH</span><br/>               <span style="color: #A0A0A0">  32</span> <span style="color: #228B22; background: #FFFFFF;">%                                              (6) body port and (-6) starboard directions relative to geocentric LVLH</span><br/>               <span style="color: #A0A0A0">  33</span> <span style="color: #228B22; background: #FFFFFF;">%   AntennaPattern      filenames              Specify antenna pattern for each antenna, existing antennas are:</span><br/>               <span style="color: #A0A0A0">  34</span> <span style="color: #228B22; background: #FFFFFF;">%                                              sensysmeas_ant.txt        - hemi antenna, 4 dB peak gain, 157 degree half beamwidth</span><br/>               <span style="color: #A0A0A0">  35</span> <span style="color: #228B22; background: #FFFFFF;">%                                              omni.txt                  - zero dB gain,  180 degree half beamwidth</span><br/>               <span style="color: #A0A0A0">  36</span> <span style="color: #228B22; background: #FFFFFF;">%                                              trimblepatch_ant.txt      - hemi antenna, 4.5 dB gain, 90 deg half beamwidth</span><br/>               <span style="color: #A0A0A0">  37</span> <span style="color: #228B22; background: #FFFFFF;">%                                              ballhybrid_10db_60deg.txt - high gain, 10 db peak gain, 60 degree half-beamwidth</span><br/>               <span style="color: #A0A0A0">  38</span> <span style="color: #228B22; background: #FFFFFF;">%                                              ao40_hga_measured_10db.txt- another 10 dB HGA with 90 deg beamwidth</span><br/>               <span style="color: #A0A0A0">  39</span> <span style="color: #228B22; background: #FFFFFF;">%   AntennaMask         radians                Global receiving antenna mask angle.  The lesser of the </span><br/>               <span style="color: #A0A0A0">  40</span> <span style="color: #228B22; background: #FFFFFF;">%                                              maximum defined angle of the pattern and this number used</span><br/>               <span style="color: #A0A0A0">  41</span> <span style="color: #228B22; background: #FFFFFF;">%   AtmosphereMask      kilometers             Troposphere mask radius ~50 km</span><br/>               <span style="color: #A0A0A0">  42</span> <span style="color: #228B22; background: #FFFFFF;">%                                              Ionosphere mask radius ~(500-1000 km)</span><br/>               <span style="color: #A0A0A0">  43</span> <span style="color: #228B22; background: #FFFFFF;">%   NoiseTemp           Kelvin                 System noise temp [K], space pointing antenna = 290</span><br/>               <span style="color: #A0A0A0">  44</span> <span style="color: #228B22; background: #FFFFFF;">%                                              System noise temp [K], earth pointing antenna = 300</span><br/>               <span style="color: #A0A0A0">  45</span> <span style="color: #228B22; background: #FFFFFF;">%   AtmAttenuation      dB                     Attenuation due to atmosphere (should be negative) [dB]</span><br/>               <span style="color: #A0A0A0">  46</span> <span style="color: #228B22; background: #FFFFFF;">%   TransPowerLevel     {1, 2(default), 3}     Transmitter Power Level  (1-minimum, 2-typical, 3-max)</span><br/>               <span style="color: #A0A0A0">  47</span> <span style="color: #228B22; background: #FFFFFF;">%   TransPowerOffset    dB                     Global transmitter power offset</span><br/>               <span style="color: #A0A0A0">  48</span> <span style="color: #228B22; background: #FFFFFF;">%   GPSBlock            {1(default), 2, 3, 4}  GPS Satellite Block  (1-II/IIA, 2-IIR, 3-IIR-M, 4-IIF)</span><br/>               <span style="color: #A0A0A0">  49</span> <span style="color: #228B22; background: #FFFFFF;">%   TransAntMask        Radians                The actual mask used is the lesser of this mask and the limit of the defined pattern</span><br/>               <span style="color: #A0A0A0">  50</span> <span style="color: #228B22; background: #FFFFFF;">%                                              mask = 70 deg includes entire defined pattern</span><br/>               <span style="color: #A0A0A0">  51</span> <span style="color: #228B22; background: #FFFFFF;">%                                              mask = 42 deg includes only main and first side lobes</span><br/>               <span style="color: #A0A0A0">  52</span> <span style="color: #228B22; background: #FFFFFF;">%                                              mask = 26 deg includes only main lobe</span><br/>               <span style="color: #A0A0A0">  53</span> <span style="color: #228B22; background: #FFFFFF;">%   ReceiverNoise       dB                     Noise figure of receiver/LNA</span><br/>               <span style="color: #A0A0A0">  54</span> <span style="color: #228B22; background: #FFFFFF;">%   RecConversionLoss   dB                     Receiver implementation, A/D conversion losses [dB]</span><br/>               <span style="color: #A0A0A0">  55</span> <span style="color: #228B22; background: #FFFFFF;">%                                              Novatel: L = -4.0,  Plessey: L = -1.5		</span><br/>               <span style="color: #A0A0A0">  56</span> <span style="color: #228B22; background: #FFFFFF;">%   SystemLoss          dB                     System losses, in front of LNA</span><br/>               <span style="color: #A0A0A0">  57</span> <span style="color: #228B22; background: #FFFFFF;">%   LNAGain             dB                     LNA gain (trimble pre-amp spec = 42-48)</span><br/>               <span style="color: #A0A0A0">  58</span> <span style="color: #228B22; background: #FFFFFF;">%   CableLoss           dB                     Cable losses (after LNA)</span><br/>               <span style="color: #A0A0A0">  59</span> <span style="color: #228B22; background: #FFFFFF;">%   RecAcqThresh        dB-Hz                  Receiver acquisition threshold</span><br/>               <span style="color: #A0A0A0">  60</span> <span style="color: #228B22; background: #FFFFFF;">%   RecTrackThresh      dB-Hz                  Receiver tracking threshold</span><br/>               <span style="color: #A0A0A0">  61</span> <span style="color: #228B22; background: #FFFFFF;">%   DynamicTrackRange   dB                     Dynamic tracking range of receiver, or maximum difference  </span><br/>               <span style="color: #A0A0A0">  62</span> <span style="color: #228B22; background: #FFFFFF;">%                                              in power levels tracked simultaneously. If the difference</span><br/>               <span style="color: #A0A0A0">  63</span> <span style="color: #228B22; background: #FFFFFF;">%                                              in snrs between two satellites is more that dyn_range,</span><br/>               <span style="color: #A0A0A0">  64</span> <span style="color: #228B22; background: #FFFFFF;">%                                              the weaker of the two will not be considered visible. </span><br/>               <span style="color: #A0A0A0">  65</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">  66</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">  67</span> <span style="color: #228B22; background: #FFFFFF;">% The options parameters associated with each of the desired measurement</span><br/>               <span style="color: #A0A0A0">  68</span> <span style="color: #228B22; background: #FFFFFF;">% types are also valid and are passed to the appropriate function.</span><br/>               <span style="color: #A0A0A0">  69</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">  70</span> <span style="color: #228B22; background: #FFFFFF;">% The measurements are output in y. Each column corresponds to a different</span><br/>               <span style="color: #A0A0A0">  71</span> <span style="color: #228B22; background: #FFFFFF;">% time. All the measurements for each gps satellite are grouped together in</span><br/>               <span style="color: #A0A0A0">  72</span> <span style="color: #228B22; background: #FFFFFF;">% rows. Thus, using the default options settings, the output y will look like:</span><br/>               <span style="color: #A0A0A0">  73</span> <span style="color: #228B22; background: #FFFFFF;">%   y = [   range_gs1(t1)       range_gs1(t2)...;</span><br/>               <span style="color: #A0A0A0">  74</span> <span style="color: #228B22; background: #FFFFFF;">%           rangeRate_gs1(t1)   rangeRate_gs1(t2)...;</span><br/>               <span style="color: #A0A0A0">  75</span> <span style="color: #228B22; background: #FFFFFF;">%           range_gs2(t1)       range_gs2(t2)...;</span><br/>               <span style="color: #A0A0A0">  76</span> <span style="color: #228B22; background: #FFFFFF;">%           rangeRate_gs2(t1)   rangeRate_gs2(t2)...;</span><br/>               <span style="color: #A0A0A0">  77</span> <span style="color: #228B22; background: #FFFFFF;">%           range_gs3(t1)       range_gs3(t2)...;</span><br/>               <span style="color: #A0A0A0">  78</span> <span style="color: #228B22; background: #FFFFFF;">%           rangeRate_gs3(t1)   rangeRate_gs3(t2)  ]</span><br/>               <span style="color: #A0A0A0">  79</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">  80</span> <span style="color: #228B22; background: #FFFFFF;">% IMPORTANT NOTES:</span><br/>               <span style="color: #A0A0A0">  81</span> <span style="color: #228B22; background: #FFFFFF;">%   1) H output does not currently support doppler measurements</span><br/>               <span style="color: #A0A0A0">  82</span> <span style="color: #228B22; background: #FFFFFF;">%   2) Doppler elevation angle constraint only works if range or rangeRate</span><br/>               <span style="color: #A0A0A0">  83</span> <span style="color: #228B22; background: #FFFFFF;">%      are also calculated</span><br/>               <span style="color: #A0A0A0">  84</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">  85</span> <span style="color: #228B22; background: #FFFFFF;">%   INPUTS</span><br/>               <span style="color: #A0A0A0">  86</span> <span style="color: #228B22; background: #FFFFFF;">%   VARIABLE        SIZE    DESCRIPTION (Optional/Default)</span><br/>               <span style="color: #A0A0A0">  87</span> <span style="color: #228B22; background: #FFFFFF;">%      t            (1xN)	measurement times (secs)</span><br/>               <span style="color: #A0A0A0">  88</span> <span style="color: #228B22; background: #FFFFFF;">%      x            (6xN)   spacecraft state [position;velocity] (km)</span><br/>               <span style="color: #A0A0A0">  89</span> <span style="color: #228B22; background: #FFFFFF;">%      options      (1x1)   data structure</span><br/>               <span style="color: #A0A0A0">  90</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">  91</span> <span style="color: #228B22; background: #FFFFFF;">%   OUTPUTS</span><br/>               <span style="color: #A0A0A0">  92</span> <span style="color: #228B22; background: #FFFFFF;">%      y            (MxN)   measurements</span><br/>               <span style="color: #A0A0A0">  93</span> <span style="color: #228B22; background: #FFFFFF;">%      H            (Mx6xN) measurement partials matrix</span><br/>               <span style="color: #A0A0A0">  94</span> <span style="color: #228B22; background: #FFFFFF;">%      R            (MxMxN) measurement covariance</span><br/>               <span style="color: #A0A0A0">  95</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">  96</span> <span style="color: #228B22; background: #FFFFFF;">%   keyword: measurement</span><br/>               <span style="color: #A0A0A0">  97</span> <span style="color: #228B22; background: #FFFFFF;">%   See also RANGE, RANGERATE, DOPPLER, ODTBXOPTIONS,</span><br/>               <span style="color: #A0A0A0">  98</span> <span style="color: #228B22; background: #FFFFFF;">%   CREATEGROUNDSTATIONLIST</span><br/>               <span style="color: #A0A0A0">  99</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 100</span> <span style="color: #228B22; background: #FFFFFF;">%  REVISION HISTORY</span><br/>               <span style="color: #A0A0A0"> 101</span> <span style="color: #228B22; background: #FFFFFF;">%   Author      		Date         	Comment</span><br/>               <span style="color: #A0A0A0"> 102</span> <span style="color: #228B22; background: #FFFFFF;">%   Kevin Berry         09/07/2007      Original</span><br/>               <span style="color: #A0A0A0"> 103</span> <span style="color: #228B22; background: #FFFFFF;">%   Russell Carpenter   07/18/2008      Various bug fixes &amp; improvements</span><br/>               <span style="color: #A0A0A0"> 104</span> <span style="color: #228B22; background: #FFFFFF;">%   (for other changes, see the svn repository)</span><br/>               <span style="color: #A0A0A0"> 105</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 106</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 107</span> <span style="color: #228B22; background: #FFFFFF;">%% Get values from options</span><br/><span style="color: #FF0000">  0.99 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 108</span> <span style="color: #000000; background: #FFFFFF;">epoch           = <a href="file29.html">getOdtbxOptions</a>(options, 'epoch', <a href="file19.html">datenum</a>('Jan 1 2006') ); </span><br/><span style="color: #FF0000">  0.21 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 109</span> <span style="color: #000000; background: #FFFFFF;">useRange        = <a href="file29.html">getOdtbxOptions</a>(options, 'useRange', true ); </span><br/><span style="color: #FF0000">  0.12 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 110</span> <span style="color: #000000; background: #FFFFFF;">useDoppler      = <a href="file29.html">getOdtbxOptions</a>(options, 'useDoppler', false ); </span><br/><span style="color: #FF0000">  0.11 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 111</span> <span style="color: #000000; background: #FFFFFF;">GPSBand         = <a href="file29.html">getOdtbxOptions</a>(options, 'GPSBand', 'L1' ); </span><br/><span style="color: #FF0000">  0.11 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 112</span> <span style="color: #000000; background: #FFFFFF;">YumaFile        = <a href="file29.html">getOdtbxOptions</a>(options, 'YumaFile', 'Yuma1356.txt' ); </span><br/><span style="color: #FF0000">  0.12 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 113</span> <span style="color: #000000; background: #FFFFFF;">Rotation2ECI    = <a href="file29.html">getOdtbxOptions</a>(options, 'Rotation2ECI', @<a href="file43.html">IdentRot</a> ); </span><br/>               <span style="color: #A0A0A0"> 114</span> <span style="color: #228B22; background: #FFFFFF;">                %For coordinate frames other than ECI. This value allows</span><br/>               <span style="color: #A0A0A0"> 115</span> <span style="color: #228B22; background: #FFFFFF;">                %the user to have x in any coordinate frame as long as the</span><br/>               <span style="color: #A0A0A0"> 116</span> <span style="color: #228B22; background: #FFFFFF;">                %rotation to ECI goes with it. Input must be a pointer to a</span><br/>               <span style="color: #A0A0A0"> 117</span> <span style="color: #228B22; background: #FFFFFF;">                %rotation function with time as the input.</span><br/><span style="color: #FF0000">  0.11 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 118</span> <span style="color: #000000; background: #FFFFFF;">pointing_ref    = <a href="file29.html">getOdtbxOptions</a>(options, 'AntennaPointing', [-1,1] ); </span><br/>               <span style="color: #A0A0A0"> 119</span> <span style="color: #228B22; background: #FFFFFF;">                % Specify attitude profile for each antenna</span><br/>               <span style="color: #A0A0A0"> 120</span> <span style="color: #228B22; background: #FFFFFF;">                %   (1) zenith pointing or (-1) nadir pointing wrt geocentric LVLH</span><br/>               <span style="color: #A0A0A0"> 121</span> <span style="color: #228B22; background: #FFFFFF;">                %   (2) parallel or (-2) antiparallel to the Earth-Sun vector</span><br/>               <span style="color: #A0A0A0"> 122</span> <span style="color: #228B22; background: #FFFFFF;">                %   (3) ecliptic north or south (-3)</span><br/>               <span style="color: #A0A0A0"> 123</span> <span style="color: #228B22; background: #FFFFFF;">                %   (4) fixed with respect to apogee zenith, or (-4) nadir</span><br/>               <span style="color: #A0A0A0"> 124</span> <span style="color: #228B22; background: #FFFFFF;">                %   vector apogee </span><br/>               <span style="color: #A0A0A0"> 125</span> <span style="color: #228B22; background: #FFFFFF;">                %       selected as the point of highest altitude (ephemeris must include apogee)</span><br/>               <span style="color: #A0A0A0"> 126</span> <span style="color: #228B22; background: #FFFFFF;">                %   (5) body fore and (-5) aft directions relative to geocentric LVLH</span><br/>               <span style="color: #A0A0A0"> 127</span> <span style="color: #228B22; background: #FFFFFF;">                %   (6) body port and (-6) starboard directions relative to geocentric LVLH</span><br/>               <span style="color: #A0A0A0"> 128</span> <span style="color: #228B22; background: #FFFFFF;">                % Size should be [1,num_ant]</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 129</span> <span style="color: #000000; background: #FFFFFF;">num_ant         = size(pointing_ref,2); %hasn't been tested for &gt;4 antennas </span><br/><span style="color: #FF0000">  0.11 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 130</span> <span style="color: #000000; background: #FFFFFF;">rec_pattern     = <a href="file29.html">getOdtbxOptions</a>(options, 'AntennaPattern', {'sensysmeas_ant.txt','sensysmeas_ant.txt'} ); </span><br/>               <span style="color: #A0A0A0"> 131</span> <span style="color: #228B22; background: #FFFFFF;">                %  Specify antenna pattern for each antenna, existing antennas are:</span><br/>               <span style="color: #A0A0A0"> 132</span> <span style="color: #228B22; background: #FFFFFF;">                %     sensysmeas_ant.txt        - hemi antenna, 4 dB peak gain, 157 degree half beamwidth</span><br/>               <span style="color: #A0A0A0"> 133</span> <span style="color: #228B22; background: #FFFFFF;">                %     omni.txt                  - zero dB gain,  180 degree half beamwidth</span><br/>               <span style="color: #A0A0A0"> 134</span> <span style="color: #228B22; background: #FFFFFF;">                %     trimblepatch_ant.txt      - hemi antenna, 4.5 dB gain, 90 deg half beamwidth</span><br/>               <span style="color: #A0A0A0"> 135</span> <span style="color: #228B22; background: #FFFFFF;">                %     ballhybrid_10db_60deg.txt - high gain, 10 db peak gain, 60 degree half-beamwidth</span><br/>               <span style="color: #A0A0A0"> 136</span> <span style="color: #228B22; background: #FFFFFF;">                %     ao40_hga_measured_10db.txt- another 10 dB HGA with 90 deg beamwidth</span><br/><span style="color: #FF0000">  0.11 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 137</span> <span style="color: #000000; background: #FFFFFF;">rcv_ant_mask    = <a href="file29.html">getOdtbxOptions</a>(options, 'AntennaMask', 180*pi/180 );  % in rad </span><br/>               <span style="color: #A0A0A0"> 138</span> <span style="color: #228B22; background: #FFFFFF;">                %  Global receiving antenna mask angle.  The lesser of the </span><br/>               <span style="color: #A0A0A0"> 139</span> <span style="color: #228B22; background: #FFFFFF;">                %  maximum defined angle of the pattern and this number used</span><br/><span style="color: #FF0000">  0.11 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 140</span> <span style="color: #000000; background: #FFFFFF;">AtmMask         = <a href="file29.html">getOdtbxOptions</a>(options, 'AtmosphereMask', 50 ); % km  </span><br/>               <span style="color: #A0A0A0"> 141</span> <span style="color: #228B22; background: #FFFFFF;">                %  Troposphere mask radius ~50 km</span><br/>               <span style="color: #A0A0A0"> 142</span> <span style="color: #228B22; background: #FFFFFF;">                %  Ionosphere mask radius ~(500-1000 km)</span><br/><span style="color: #FF0000">  0.11 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 143</span> <span style="color: #000000; background: #FFFFFF;">Ts              = <a href="file29.html">getOdtbxOptions</a>(options, 'NoiseTemp', 300 ); % K </span><br/>               <span style="color: #A0A0A0"> 144</span> <span style="color: #228B22; background: #FFFFFF;">                % System noise temp [K], space pointing antenna = 290</span><br/>               <span style="color: #A0A0A0"> 145</span> <span style="color: #228B22; background: #FFFFFF;">                % System noise temp [K], earth pointing antenna = 300</span><br/><span style="color: #FF0000">  0.11 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 146</span> <span style="color: #000000; background: #FFFFFF;">Ae              = <a href="file29.html">getOdtbxOptions</a>(options, 'AtmAttenuation', 0.0 ); % dB </span><br/>               <span style="color: #A0A0A0"> 147</span> <span style="color: #228B22; background: #FFFFFF;">                % attenuation due to atmosphere (should be negative) [dB]</span><br/><span style="color: #FF0000">  0.11 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 148</span> <span style="color: #000000; background: #FFFFFF;">sv_power        = <a href="file29.html">getOdtbxOptions</a>(options, 'TransPowerLevel', 2 ); % 1-minimum, 2-typical, 3-max </span><br/><span style="color: #FF0000">  0.11 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 149</span> <span style="color: #000000; background: #FFFFFF;">sv_power_offset = <a href="file29.html">getOdtbxOptions</a>(options, 'TransPowerOffset', 0.0 ); % dB, global offset </span><br/><span style="color: #FF0000">  0.11 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 150</span> <span style="color: #000000; background: #FFFFFF;">sv_block        = <a href="file29.html">getOdtbxOptions</a>(options, 'GPSBlock', 1 ); % 1-II/IIA, 2-IIR, 3-IIR-M, 4-IIF </span><br/><span style="color: #FF0000">  0.11 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 151</span> <span style="color: #000000; background: #FFFFFF;">xmit_ant_mask   = <a href="file29.html">getOdtbxOptions</a>(options, 'TransAntMask', pi );  % in rad </span><br/>               <span style="color: #A0A0A0"> 152</span> <span style="color: #228B22; background: #FFFFFF;">                %  The actual mask used is the lesser of this mask and the limit of the defined pattern</span><br/>               <span style="color: #A0A0A0"> 153</span> <span style="color: #228B22; background: #FFFFFF;">                %  Note:  mask = 70 deg includes entire defined pattern</span><br/>               <span style="color: #A0A0A0"> 154</span> <span style="color: #228B22; background: #FFFFFF;">                %         mask = 42 deg includes only main and first side lobes</span><br/>               <span style="color: #A0A0A0"> 155</span> <span style="color: #228B22; background: #FFFFFF;">                %         mask = 26 deg includes only main lobe</span><br/><span style="color: #FF0000">  0.11 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 156</span> <span style="color: #000000; background: #FFFFFF;">Nf              = <a href="file29.html">getOdtbxOptions</a>(options, 'ReceiverNoise', -3 );  % dB, Noise figure of receiver/LNA </span><br/><span style="color: #FF0000">  0.10 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 157</span> <span style="color: #000000; background: #FFFFFF;">L               = <a href="file29.html">getOdtbxOptions</a>(options, 'RecConversionLoss', -1.5 );  % dB </span><br/>               <span style="color: #A0A0A0"> 158</span> <span style="color: #228B22; background: #FFFFFF;">				% Receiver implementation, A/D conversion losses [dB]</span><br/>               <span style="color: #A0A0A0"> 159</span> <span style="color: #228B22; background: #FFFFFF;">				%   Novatel: L = -4.0 	</span><br/>               <span style="color: #A0A0A0"> 160</span> <span style="color: #228B22; background: #FFFFFF;">				%   Plessey: L = -1.5		</span><br/><span style="color: #FF0000">  0.10 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 161</span> <span style="color: #000000; background: #FFFFFF;">As              = <a href="file29.html">getOdtbxOptions</a>(options, 'SystemLoss', 0 ); % dB, System losses, in front of LNA </span><br/><span style="color: #FF0000">  0.11 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 162</span> <span style="color: #000000; background: #FFFFFF;">Ga              = <a href="file29.html">getOdtbxOptions</a>(options, 'LNAGain', 40 ); % dB, LNA gain (trimble pre-amp spec = 42-48) </span><br/><span style="color: #FF0000">  0.10 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 163</span> <span style="color: #000000; background: #FFFFFF;">Ac              = <a href="file29.html">getOdtbxOptions</a>(options, 'CableLoss', -2 ); % dB, Cable losses (after LNA) </span><br/><span style="color: #FF0000">  0.11 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 164</span> <span style="color: #000000; background: #FFFFFF;">CN0_acq         = <a href="file29.html">getOdtbxOptions</a>(options, 'RecAcqThresh', 32 ); % dB-Hz, Receiver acquisition threshold </span><br/><span style="color: #FF0000">  0.11 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 165</span> <span style="color: #000000; background: #FFFFFF;">CN0_lim         = <a href="file29.html">getOdtbxOptions</a>(options, 'RecTrackThresh', 27 ); % dB-Hz, Receiver tracking threshold </span><br/><span style="color: #FF0000">  0.11 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 166</span> <span style="color: #000000; background: #FFFFFF;">dyn_range       = <a href="file29.html">getOdtbxOptions</a>(options, 'DynamicTrackRange', 15 ); % dB </span><br/>               <span style="color: #A0A0A0"> 167</span> <span style="color: #228B22; background: #FFFFFF;">       			% Dynamic tracking range of receiver, or maximum difference  </span><br/>               <span style="color: #A0A0A0"> 168</span> <span style="color: #228B22; background: #FFFFFF;">                % in power levels tracked simultaneously. If the difference</span><br/>               <span style="color: #A0A0A0"> 169</span> <span style="color: #228B22; background: #FFFFFF;">                % in snrs between two satellites is more that dyn_range,</span><br/>               <span style="color: #A0A0A0"> 170</span> <span style="color: #228B22; background: #FFFFFF;">                % the weaker of the two will not be considered visible. </span><br/>               <span style="color: #A0A0A0"> 171</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 172</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 173</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 174</span> <span style="color: #228B22; background: #FFFFFF;">% Count number of measurement types</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 175</span> <span style="color: #000000; background: #FFFFFF;">nMTypes         = sum([useRange useDoppler]); </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 176</span> <span style="color: #000000; background: #FFFFFF;">sigmaDefault    = ones(1,nMTypes*32)*1e-3; </span><br/><span style="color: #FF0000">  0.12 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 177</span> <span style="color: #000000; background: #FFFFFF;">sigma           = <a href="file29.html">getOdtbxOptions</a>(options, 'rSigma', sigmaDefault ); </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 178</span> <span style="color: #000000; background: #FFFFFF;">sigma           = diag(sigma); </span><br/>               <span style="color: #A0A0A0"> 179</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 180</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 181</span> <span style="color: #228B22; background: #FFFFFF;">%% Get Some Constants from JAT</span><br/>               <span style="color: #A0A0A0"> 182</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/><span style="color: #FF0000">  0.26 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 183</span> <span style="color: #000000; background: #FFFFFF;">C               = <a href="file30.html">JATConstant</a>('c') / 1000;  % km/s Speed of light </span><br/><span style="color: #FF0000">  0.21 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 184</span> <span style="color: #000000; background: #FFFFFF;">EARTH_RADIUS    = <a href="file30.html">JATConstant</a>('rEarth','WGS84') / 1000;  % km Equatorial radius of Earth </span><br/>               <span style="color: #A0A0A0"> 185</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 186</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 187</span> <span style="color: #228B22; background: #FFFFFF;">%% Set Some Values</span><br/>               <span style="color: #A0A0A0"> 188</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 189</span> <span style="color: #228B22; background: #FFFFFF;">%  Select L-band carrier for simulation</span><br/>               <span style="color: #A0A0A0"> 190</span> <span style="color: #228B22; background: #FFFFFF;">%  Models civil signal power on selected carrier (C/A on L1, L2C on L2)</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 191</span> <span style="color: #000000; background: #FFFFFF;">GPSFreq.L1      = 1575.42e6;    % Hz </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 192</span> <span style="color: #000000; background: #FFFFFF;">GPSFreq.L2      = 1227.6e6;     % Hz </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 193</span> <span style="color: #000000; background: #FFFFFF;">GPSFreq.L5      = 1176.45e6;    % Hz </span><br/><span style="color: #FF0000">  0.05 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 194</span> <span style="color: #000000; background: #FFFFFF;">freq            = eval(['GPSFreq.', GPSBand]); </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 195</span> <span style="color: #000000; background: #FFFFFF;">r_mask          = EARTH_RADIUS + AtmMask;	% Atmosphere mask radius (km) </span><br/>               <span style="color: #A0A0A0"> 196</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 197</span> <span style="color: #228B22; background: #FFFFFF;">                    </span><br/>               <span style="color: #A0A0A0"> 198</span> <span style="color: #228B22; background: #FFFFFF;">%% Input Evaluation</span><br/>               <span style="color: #A0A0A0"> 199</span> <span style="color: #228B22; background: #FFFFFF;">% This Section includes GPS satellite gain pattern file names, reference transmitter</span><br/>               <span style="color: #A0A0A0"> 200</span> <span style="color: #228B22; background: #FFFFFF;">%  power values, and error checking of parameters specified in definitions file.</span><br/>               <span style="color: #A0A0A0"> 201</span> <span style="color: #228B22; background: #FFFFFF;">% Power settings all referenced to meet required minimum power at EOE</span><br/>               <span style="color: #A0A0A0"> 202</span> <span style="color: #228B22; background: #FFFFFF;">% NOTE: GPS antenna pattern data beyond 30 degrees considered LM</span><br/>               <span style="color: #A0A0A0"> 203</span> <span style="color: #228B22; background: #FFFFFF;">%       proprietary for blocks other than II/IIA</span><br/>               <span style="color: #A0A0A0"> 204</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 205</span> <span style="color: #000000; background: #FFFFFF;">switch freq </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 206</span> <span style="color: #000000; background: #FFFFFF;">    case GPSFreq.L1 </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 207</span> <span style="color: #000000; background: #FFFFFF;">        switch sv_block </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 208</span> <span style="color: #000000; background: #FFFFFF;">            case 1  % II/IIA </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 209</span> <span style="color: #000000; background: #FFFFFF;">                xmit_pattern = 'GPSIIA_L1MEAN.txt';	 % GPS SV gain pattern file </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 210</span> <span style="color: #000000; background: #FFFFFF;">                xmit_power = 13.4; </span><br/>               <span style="color: #A0A0A0"> 211</span> <span style="color: #A0A0A0; background: #FFFFFF;">            case 2  % IIR</span><br/>               <span style="color: #A0A0A0"> 212</span> <span style="color: #A0A0A0; background: #FFFFFF;">                xmit_pattern = 'GPSIIR_ALL_L1MEAN_30deg.txt';	 % GPS SV gain pattern file</span><br/>               <span style="color: #A0A0A0"> 213</span> <span style="color: #228B22; background: #FFFFFF;">                %xmit_pattern = 'GPSIIR_ALL_L1MEAN_30deg.txt';	 % GPS SV gain pattern file</span><br/>               <span style="color: #A0A0A0"> 214</span> <span style="color: #A0A0A0; background: #FFFFFF;">                xmit_power = 13.5;</span><br/>               <span style="color: #A0A0A0"> 215</span> <span style="color: #A0A0A0; background: #FFFFFF;">            case 3  % IIR-M</span><br/>               <span style="color: #A0A0A0"> 216</span> <span style="color: #A0A0A0; background: #FFFFFF;">                xmit_pattern = 'GPSIIRM_P1_L1MEAN_30deg.txt';	 % GPS SV gain pattern file</span><br/>               <span style="color: #A0A0A0"> 217</span> <span style="color: #228B22; background: #FFFFFF;">                %xmit_pattern = 'GPSIIRM_P1_L1MEAN_30deg.txt';	 % GPS SV gain pattern file</span><br/>               <span style="color: #A0A0A0"> 218</span> <span style="color: #A0A0A0; background: #FFFFFF;">                xmit_power = 12.8;</span><br/>               <span style="color: #A0A0A0"> 219</span> <span style="color: #A0A0A0; background: #FFFFFF;">            case 4  % IIF</span><br/>               <span style="color: #A0A0A0"> 220</span> <span style="color: #A0A0A0; background: #FFFFFF;">                error('Unsupported Option: No IIF antenna patterns defined')</span><br/>               <span style="color: #A0A0A0"> 221</span> <span style="color: #A0A0A0; background: #FFFFFF;">            case 5  % III  - currently use IIR-M gain pattern and -158.5 min power</span><br/>               <span style="color: #A0A0A0"> 222</span> <span style="color: #228B22; background: #FFFFFF;">                %xmit_pattern = 'GPSIIRM_P1_L1MEAN.txt';	 % GPS SV gain pattern file</span><br/>               <span style="color: #A0A0A0"> 223</span> <span style="color: #A0A0A0; background: #FFFFFF;">                xmit_pattern = 'GPSIIRM_P1_L1MEAN_30deg.txt';	 % GPS SV gain pattern file</span><br/>               <span style="color: #A0A0A0"> 224</span> <span style="color: #A0A0A0; background: #FFFFFF;">                xmit_power = 12.8;</span><br/>               <span style="color: #A0A0A0"> 225</span> <span style="color: #A0A0A0; background: #FFFFFF;">        end</span><br/>               <span style="color: #A0A0A0"> 226</span> <span style="color: #A0A0A0; background: #FFFFFF;">    case GPSFreq.L2</span><br/>               <span style="color: #A0A0A0"> 227</span> <span style="color: #A0A0A0; background: #FFFFFF;">        switch sv_block</span><br/>               <span style="color: #A0A0A0"> 228</span> <span style="color: #A0A0A0; background: #FFFFFF;">            case 1  % II/IIA</span><br/>               <span style="color: #A0A0A0"> 229</span> <span style="color: #A0A0A0; background: #FFFFFF;">                error('Unsupported Option: No IIA L2 antenna pattern defined');	 % GPS SV gain pattern file</span><br/>               <span style="color: #A0A0A0"> 230</span> <span style="color: #A0A0A0; background: #FFFFFF;">            case 2  % IIR</span><br/>               <span style="color: #A0A0A0"> 231</span> <span style="color: #A0A0A0; background: #FFFFFF;">                xmit_pattern = 'GPSIIR_ALL_L2MEAN_30deg.txt';	 % GPS SV gain pattern file</span><br/>               <span style="color: #A0A0A0"> 232</span> <span style="color: #228B22; background: #FFFFFF;">                %xmit_pattern = 'GPSIIR_ALL_L2MEAN_30deg.txt';	 % GPS SV gain pattern file</span><br/>               <span style="color: #A0A0A0"> 233</span> <span style="color: #A0A0A0; background: #FFFFFF;">                xmit_power = 6.9;</span><br/>               <span style="color: #A0A0A0"> 234</span> <span style="color: #A0A0A0; background: #FFFFFF;">            case 3  % IIR-M</span><br/>               <span style="color: #A0A0A0"> 235</span> <span style="color: #A0A0A0; background: #FFFFFF;">                xmit_pattern = 'GPSIIRM_P1_L2MEAN_30deg.txt';	 % GPS SV gain pattern file</span><br/>               <span style="color: #A0A0A0"> 236</span> <span style="color: #228B22; background: #FFFFFF;">                %xmit_pattern = 'GPSIIRM_P1_L2MEAN_30deg.txt';	 % GPS SV gain pattern file</span><br/>               <span style="color: #A0A0A0"> 237</span> <span style="color: #A0A0A0; background: #FFFFFF;">                xmit_power = 9.4;</span><br/>               <span style="color: #A0A0A0"> 238</span> <span style="color: #A0A0A0; background: #FFFFFF;">            case 4  % IIF</span><br/>               <span style="color: #A0A0A0"> 239</span> <span style="color: #A0A0A0; background: #FFFFFF;">                error('Unsupported Option: No IIF antenna patterns defined')</span><br/>               <span style="color: #A0A0A0"> 240</span> <span style="color: #A0A0A0; background: #FFFFFF;">            case 5  % III  - currently use IIR-M gain pattern and -158.5 min power</span><br/>               <span style="color: #A0A0A0"> 241</span> <span style="color: #A0A0A0; background: #FFFFFF;">                xmit_pattern = 'GPSIIRM_P1_L2MEAN_30deg.txt';	 % GPS SV gain pattern file</span><br/>               <span style="color: #A0A0A0"> 242</span> <span style="color: #A0A0A0; background: #FFFFFF;">                xmit_power = 10.9;</span><br/>               <span style="color: #A0A0A0"> 243</span> <span style="color: #A0A0A0; background: #FFFFFF;">        end</span><br/>               <span style="color: #A0A0A0"> 244</span> <span style="color: #A0A0A0; background: #FFFFFF;">end</span><br/>               <span style="color: #A0A0A0"> 245</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 246</span> <span style="color: #228B22; background: #FFFFFF;">% Apply global offset to transmitter power</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 247</span> <span style="color: #000000; background: #FFFFFF;">xmit_power = xmit_power + sv_power_offset; </span><br/>               <span style="color: #A0A0A0"> 248</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 249</span> <span style="color: #000000; background: #FFFFFF;">switch sv_power    % Set power into transmitter </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 250</span> <span style="color: #000000; background: #FFFFFF;">    case 1 </span><br/>               <span style="color: #A0A0A0"> 251</span> <span style="color: #A0A0A0; background: #FFFFFF;">        P_sv = xmit_power;</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 252</span> <span style="color: #000000; background: #FFFFFF;">    case 2 </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 253</span> <span style="color: #000000; background: #FFFFFF;">        P_sv = xmit_power + 1.5; </span><br/>               <span style="color: #A0A0A0"> 254</span> <span style="color: #A0A0A0; background: #FFFFFF;">    case 3</span><br/>               <span style="color: #A0A0A0"> 255</span> <span style="color: #A0A0A0; background: #FFFFFF;">        P_sv = xmit_power + 3.0;</span><br/>               <span style="color: #A0A0A0"> 256</span> <span style="color: #A0A0A0; background: #FFFFFF;">end</span><br/>               <span style="color: #A0A0A0"> 257</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 258</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 259</span> <span style="color: #228B22; background: #FFFFFF;">%% Create the spacecraft position and velocity</span><br/>               <span style="color: #A0A0A0"> 260</span> <span style="color: #228B22; background: #FFFFFF;">% For GPS calculations, it is best to Rotate to ECEF</span><br/><span style="color: #FF0000">  2.12 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 261</span> <a name="Line261"></a><span style="color: #000000; background: #FFF0F0;">init2fixed  = <a href="file31.html">jatDCM</a>('eci2ecef', t+epoch); </span><br/><span style="color: #FF0000">  0.21 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 262</span> <span style="color: #000000; background: #FFFFFF;">w           = [0;0;<a href="file30.html">JATConstant</a>('wEarth')]; </span><br/><span style="color: #FF0000">  0.11 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 263</span> <span style="color: #000000; background: #FFFFFF;">eciRotation = <a href="file41.html">rotransf</a>(<a href="file40.html">repmat</a>(w,[1,length(t)]),init2fixed); </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 264</span> <span style="color: #000000; background: #FFFFFF;">for n=1:length(t) </span><br/><span style="color: #FF0000">  0.03 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 265</span> <span style="color: #000000; background: #FFFFFF;">    xf             = eciRotation(1:6,1:6,n) * Rotation2ECI(t(n)) * x(:,n); %km </span><br/><a name="Line266"></a><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 266</span> <span style="color: #000000; background: #FFFFFF;">    sat_pos(1:3,n) = xf(1:3); </span><br/><a name="Line267"></a><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 267</span> <span style="color: #000000; background: #FFFFFF;">    sat_vel(1:3,n) = xf(4:6); </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 268</span> <span style="color: #000000; background: #FFFFFF;">end </span><br/>               <span style="color: #A0A0A0"> 269</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 270</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 271</span> <span style="color: #228B22; background: #FFFFFF;">%% Get the positions of the GPS satellites</span><br/>               <span style="color: #A0A0A0"> 272</span> <span style="color: #228B22; background: #FFFFFF;">%  Convert simulation start time</span><br/><span style="color: #FF0000">  1.33 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 273</span> <span style="color: #000000; background: #FFFFFF;">time = 86400 * <a href="file23.html">convertTime</a>('GPS','UTC', epoch+t/86400); </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 274</span> <span style="color: #000000; background: #FFFFFF;">nn   = size(time(:),1);			% Number of time steps </span><br/>               <span style="color: #A0A0A0"> 275</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 276</span> <span style="color: #228B22; background: #FFFFFF;">% Read the input file</span><br/><span style="color: #FF0000"> 20.43 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 277</span> <a name="Line277"></a><span style="color: #000000; background: #FF8080;">[gps_alm] = <a href="file24.html">read_yuma</a>(YumaFile,0,0); </span><br/>               <span style="color: #A0A0A0"> 278</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 279</span> <span style="color: #228B22; background: #FFFFFF;">% Find the list of PRNs with valid almanac health flag</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 280</span> <span style="color: #000000; background: #FFFFFF;">healthy = gps_alm(:,2)==0; </span><br/><a name="Line281"></a><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 281</span> <span style="color: #000000; background: #FFFFFF;">prns = gps_alm(find(healthy),1); </span><br/>               <span style="color: #A0A0A0"> 282</span> <span style="color: #228B22; background: #FFFFFF;">% mm = size(prns,1); % Number of GPS PRNs listed in almanac</span><br/>               <span style="color: #A0A0A0"> 283</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 284</span> <span style="color: #228B22; background: #FFFFFF;">% Compute satellite orbits from almanac parameters</span><br/>               <span style="color: #A0A0A0"> 285</span> <span style="color: #228B22; background: #FFFFFF;">% Only hand in almanac parameters for healthy SVs</span><br/>               <span style="color: #A0A0A0"> 286</span> <span style="color: #228B22; background: #FFFFFF;">% Initialize variables</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 287</span> <span style="color: #000000; background: #FFFFFF;">gps_pos = zeros(3,nn,32); </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 288</span> <span style="color: #000000; background: #FFFFFF;">gps_vel = zeros(3,nn,32); </span><br/>               <span style="color: #A0A0A0"> 289</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/><a name="Line290"></a><span style="color: #FF0000">  0.31 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 290</span> <span style="color: #000000; background: #FFFFFF;">[pos,vel] = <a href="file50.html">alm2xyz</a>(time(:)',gps_alm(find(healthy),:),1);	% [3,nn,mm] arrays </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 291</span> <span style="color: #000000; background: #FFFFFF;">gps_pos(:,:,prns) = pos; %km </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 292</span> <span style="color: #000000; background: #FFFFFF;">gps_vel(:,:,prns) = vel; %km </span><br/><span style="color: #FF0000">  0.02 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 293</span> <span style="color: #000000; background: #FFFFFF;">clear pos vel </span><br/>               <span style="color: #A0A0A0"> 294</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 295</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 296</span> <span style="color: #228B22; background: #FFFFFF;">%% Compute Visability</span><br/>               <span style="color: #A0A0A0"> 297</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 298</span> <span style="color: #228B22; background: #FFFFFF;">% Compute matrix describing antenna boresite(s) [3*num_ant,nn]</span><br/><span style="color: #FF0000">  0.07 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 299</span> <span style="color: #000000; background: #FFFFFF;">[boresite] = <a href="file51.html">comp_bs_3d</a>(num_ant,t,sat_pos,sat_vel,pointing_ref,1);  % [(3*num_ant),nn] </span><br/>               <span style="color: #A0A0A0"> 300</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/><a name="Line301"></a><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 301</span> <span style="color: #000000; background: #FFFFFF;">health = [reshape(max(gps_pos),nn,32) ~=0];        % [32,nn] </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 302</span> <span style="color: #000000; background: #FFFFFF;">rgps_mag = reshape(sqrt(sum(gps_pos.^2)),nn,32);    % [nn,32] </span><br/><a name="Line303"></a><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 303</span> <span style="color: #000000; background: #FFFFFF;">vgps_mag = reshape(sqrt(sum(gps_vel.^2)),nn,32);    % [nn,32] </span><br/>               <span style="color: #A0A0A0"> 304</span> <span style="color: #228B22; background: #FFFFFF;">% sat_pos [3,nn]</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 305</span> <span style="color: #000000; background: #FFFFFF;">ruser_mag = sqrt(sum(sat_pos.^2));                 % [1,nn] </span><br/><a name="Line306"></a><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 306</span> <span style="color: #000000; background: #FFFFFF;">ruser_unit = sat_pos./([1;1;1]*ruser_mag);         % [3,nn] </span><br/>               <span style="color: #A0A0A0"> 307</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 308</span> <span style="color: #000000; background: #FFFFFF;">ruser_3d = zeros(3,nn,32); </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 309</span> <span style="color: #000000; background: #FFFFFF;">vuser_3d = zeros(3,nn,32); </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 310</span> <span style="color: #000000; background: #FFFFFF;">for i=1:32 </span><br/><span style="color: #FF0000">  0.02 </span><span style="color: #0000FF">  23072 </span><span style="color: #000000; font-weight: bold"> 311</span> <span style="color: #000000; background: #FFFFFF;">    ruser_3d(:,:,i) = sat_pos;                     % [3,nn,32] </span><br/><span style="color: #FF0000">  0.02 </span><span style="color: #0000FF">  23072 </span><span style="color: #000000; font-weight: bold"> 312</span> <span style="color: #000000; background: #FFFFFF;">    vuser_3d(:,:,i) = sat_vel;                     % [3,nn,32] </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">  23072 </span><span style="color: #000000; font-weight: bold"> 313</span> <span style="color: #000000; background: #FFFFFF;">end </span><br/>               <span style="color: #A0A0A0"> 314</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 315</span> <span style="color: #000000; background: #FFFFFF;">los_3d = gps_pos - ruser_3d;                          % [3,nn,32] </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 316</span> <span style="color: #000000; background: #FFFFFF;">los_mag = reshape(sqrt(sum(los_3d.^2)),nn,32);     % [nn,32] </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 317</span> <span style="color: #000000; background: #FFFFFF;">los_mag_3d = zeros(3,nn,32); </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 318</span> <span style="color: #000000; background: #FFFFFF;">for i=1:3 </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   2163 </span><span style="color: #000000; font-weight: bold"> 319</span> <span style="color: #000000; background: #FFFFFF;">    los_mag_3d(i,:,:) = los_mag;                   % [3,nn,32] </span><br/><a name="Line320"></a><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   2163 </span><span style="color: #000000; font-weight: bold"> 320</span> <span style="color: #000000; background: #FFFFFF;">    rgps_mag_3d(i,:,:) = rgps_mag;                 % [3,nn,32] </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   2163 </span><span style="color: #000000; font-weight: bold"> 321</span> <span style="color: #000000; background: #FFFFFF;">end </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 322</span> <span style="color: #000000; background: #FFFFFF;">los_unit_3d = los_3d./los_mag_3d;                  % [3,nn,32] </span><br/>               <span style="color: #A0A0A0"> 323</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 324</span> <span style="color: #228B22; background: #FFFFFF;">%--- Compute elevation angles wrt GPS SV antenna</span><br/>               <span style="color: #A0A0A0"> 325</span> <span style="color: #228B22; background: #FFFFFF;">% SV off-boresite angle - this is the transmitter 'elevation' angle</span><br/>               <span style="color: #A0A0A0"> 326</span> <span style="color: #228B22; background: #FFFFFF;">% measured between los and the SV antenna boresite (nadir)</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 327</span> <span style="color: #000000; background: #FFFFFF;">denom=rgps_mag.*los_mag; </span><br/><a name="Line328"></a><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 328</span> <span style="color: #000000; background: #FFFFFF;">denom(find(denom==0))=NaN; </span><br/><span style="color: #FF0000">  0.03 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 329</span> <span style="color: #000000; background: #FFFFFF;">alpha_t = acos(reshape(<a href="file52.html">dot</a>(gps_pos,los_3d),nn,32)./denom);    % (nn,32) </span><br/>               <span style="color: #A0A0A0"> 330</span> <span style="color: #228B22; background: #FFFFFF;">% Set alpha_t for non-existent/unhealthy SVs to 180 deg</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 331</span> <span style="color: #000000; background: #FFFFFF;">alpha_t(~health) = pi; </span><br/>               <span style="color: #A0A0A0"> 332</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 333</span> <span style="color: #000000; background: #FFFFFF;">svazi = zeros(size(health)); </span><br/>               <span style="color: #A0A0A0"> 334</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 335</span> <span style="color: #228B22; background: #FFFFFF;">%  Doppler in m/s (relative velocity projected along the LOS)</span><br/>               <span style="color: #A0A0A0"> 336</span> <span style="color: #228B22; background: #FFFFFF;">%  DOES NOT ACCOUNT FOR SECOND ORDER DOPPLER EFFECT DUE TO RELATIVITY</span><br/><span style="color: #FF0000">  0.02 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 337</span> <span style="color: #000000; background: #FFFFFF;">doppler = reshape(<a href="file52.html">dot</a>(los_unit_3d,(gps_vel - vuser_3d)),nn,32);      % (nn,32) </span><br/>               <span style="color: #A0A0A0"> 338</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 339</span> <span style="color: #228B22; background: #FFFFFF;">% Compute angle subtended by Earth and Earth mask angles for each SV</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 340</span> <span style="color: #000000; background: #FFFFFF;">denom=rgps_mag; </span><br/><a name="Line341"></a><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 341</span> <span style="color: #000000; background: #FFFFFF;">denom(find(denom==0))=NaN; </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 342</span> <span style="color: #000000; background: #FFFFFF;">gamma = asin(EARTH_RADIUS./denom);   % Angle subtended by Earth at SV (nn,32) </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 343</span> <span style="color: #000000; background: #FFFFFF;">gamma_mask = asin(r_mask./denom);    % Angle subtended by Earth plus altitude mask (nn,32) </span><br/>               <span style="color: #A0A0A0"> 344</span> <span style="color: #228B22; background: #FFFFFF;">%  Set prns visible if not blocked by Earth</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 345</span> <span style="color: #000000; background: #FFFFFF;">vis_earth = (alpha_t &gt; gamma) | (los_mag &lt;= rgps_mag.*cos(gamma));   % (nn,32) </span><br/>               <span style="color: #A0A0A0"> 346</span> <span style="color: #228B22; background: #FFFFFF;">%  Set prns visible if not subject to atmosphere mask</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 347</span> <span style="color: #000000; background: #FFFFFF;">vis_atm = (alpha_t &gt; gamma_mask) | (los_mag&lt;=rgps_mag.*cos(gamma_mask)); % (nn,32) </span><br/>               <span style="color: #A0A0A0"> 348</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 349</span> <span style="color: #000000; background: #FFFFFF;">HuLOS = los_unit_3d; </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 350</span> <span style="color: #000000; background: #FFFFFF;">Hrange = los_mag'; </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 351</span> <span style="color: #000000; background: #FFFFFF;">Hdoppler = doppler'; </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 352</span> <span style="color: #000000; background: #FFFFFF;">Halpha_t = alpha_t'; </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 353</span> <span style="color: #000000; background: #FFFFFF;">Hvis_earth = vis_earth'; </span><br/><a name="Line354"></a><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 354</span> <span style="color: #000000; background: #FFFFFF;">Hvis_atm = vis_atm'; </span><br/><a name="Line355"></a><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 355</span> <span style="color: #000000; background: #FFFFFF;">HSVazi = svazi'; </span><br/>               <span style="color: #A0A0A0"> 356</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 357</span> <span style="color: #228B22; background: #FFFFFF;">%% Compute antenna specific data</span><br/><a name="Line358"></a><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 358</span> <span style="color: #000000; background: #FFFFFF;">variable_str = ['health HuLOS Hrange Hdoppler Halpha_t Hvis_earth Hvis_atm HSVazi ']; </span><br/>               <span style="color: #A0A0A0"> 359</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 360</span> <span style="color: #000000; background: #FFFFFF;">if num_ant &lt;= 1 </span><br/>               <span style="color: #A0A0A0"> 361</span> <span style="color: #A0A0A0; background: #FFFFFF;">    loop = 1;   % execute loop once for zero or one antennas</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 362</span> <span style="color: #228B22; background: #FFFFFF;">else </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 363</span> <span style="color: #000000; background: #FFFFFF;">    loop = num_ant;  % otherwise loop once for each additional antenna </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 364</span> <span style="color: #000000; background: #FFFFFF;">end </span><br/>               <span style="color: #A0A0A0"> 365</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 366</span> <span style="color: #000000; background: #FFFFFF;">for ANT=1:loop </span><br/>               <span style="color: #A0A0A0"> 367</span> <span style="color: #228B22; background: #FFFFFF;">    % Transmitter and receiver antenna masks</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 368</span> <span style="color: #000000; background: #FFFFFF;">    beta_t = xmit_ant_mask; </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 369</span> <span style="color: #000000; background: #FFFFFF;">    beta_r = rcv_ant_mask; </span><br/>               <span style="color: #A0A0A0"> 370</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 371</span> <span style="color: #228B22; background: #FFFFFF;">    % Transpose appropriate matrices for local use</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 372</span> <span style="color: #000000; background: #FFFFFF;">    los_unit_3d = HuLOS;                             % [3,nn,32] </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 373</span> <span style="color: #000000; background: #FFFFFF;">    los_mag = Hrange';                               % [nn,32] </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 374</span> <span style="color: #000000; background: #FFFFFF;">    alpha_t = Halpha_t';                             % [nn,32] </span><br/>               <span style="color: #A0A0A0"> 375</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 376</span> <span style="color: #000000; background: #FFFFFF;">    nn = size(health,1);			% Number of time steps </span><br/>               <span style="color: #A0A0A0"> 377</span> <span style="color: #228B22; background: #FFFFFF;">    %------------------------------------------------------------------------------</span><br/>               <span style="color: #A0A0A0"> 378</span> <span style="color: #228B22; background: #FFFFFF;">    % USER ANTENNA</span><br/>               <span style="color: #A0A0A0"> 379</span> <span style="color: #228B22; background: #FFFFFF;">    % alpha_r - receiver off-boresite angle, measured from recv antenna boresite</span><br/>               <span style="color: #A0A0A0"> 380</span> <span style="color: #228B22; background: #FFFFFF;">    %% boresite  % {3,nn]</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 381</span> <span style="color: #000000; background: #FFFFFF;">    boresite_3d = zeros(3,nn,32); </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 382</span> <span style="color: #000000; background: #FFFFFF;">    for i=1:32 </span><br/><span style="color: #FF0000">  0.13 </span><span style="color: #0000FF">  46144 </span><span style="color: #000000; font-weight: bold"> 383</span> <span style="color: #000000; background: #FFFFFF;">        boresite_3d(:,:,i) = reshape(boresite(:,:,ANT),3,nn);    % [3,nn,32] </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">  46144 </span><span style="color: #000000; font-weight: bold"> 384</span> <span style="color: #000000; background: #FFFFFF;">    end </span><br/>               <span style="color: #A0A0A0"> 385</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/><span style="color: #FF0000">  0.05 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 386</span> <span style="color: #000000; background: #FFFFFF;">    alpha_r = acos(reshape(<a href="file52.html">dot</a>(boresite_3d,los_unit_3d),nn,32));  % (nn,32) </span><br/>               <span style="color: #A0A0A0"> 387</span> <span style="color: #228B22; background: #FFFFFF;">    % Set alpha_r for non-existent/unhealthy SVs to 180 deg</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 388</span> <span style="color: #000000; background: #FFFFFF;">    alpha_r(~health) = pi; </span><br/>               <span style="color: #A0A0A0"> 389</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 390</span> <span style="color: #228B22; background: #FFFFFF;">    % Compute user local azimuth (with respect to antenna zero azimuth direction</span><br/>               <span style="color: #A0A0A0"> 391</span> <span style="color: #228B22; background: #FFFFFF;">    % Required for evaluating receiver gain from 2-D receiver antenna pattern</span><br/>               <span style="color: #A0A0A0"> 392</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 393</span> <span style="color: #228B22; background: #FFFFFF;">    %------------------------------------------------------------------------------</span><br/>               <span style="color: #A0A0A0"> 394</span> <span style="color: #228B22; background: #FFFFFF;">    % EVALUATION OF GEOMETRIC CONSTRAINTS</span><br/>               <span style="color: #A0A0A0"> 395</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 396</span> <span style="color: #228B22; background: #FFFFFF;">    %  Set prns visible if los within antenna mask angles</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 397</span> <span style="color: #000000; background: #FFFFFF;">    vis_beta_t = (alpha_t &lt;= beta_t); </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 398</span> <span style="color: #000000; background: #FFFFFF;">    vis_beta = vis_beta_t &amp; (alpha_r &lt;= beta_r);    % (nn,32) </span><br/>               <span style="color: #A0A0A0"> 399</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 400</span> <span style="color: #228B22; background: #FFFFFF;">    %------------------------------------------------------------------------------</span><br/>               <span style="color: #A0A0A0"> 401</span> <span style="color: #228B22; background: #FFFFFF;">    % LINK CALCULATIONS</span><br/>               <span style="color: #A0A0A0"> 402</span> <span style="color: #228B22; background: #FFFFFF;">    %  Attenuation from R^2 losses, where L1 wavelength = 0.1903 [m]</span><br/><span style="color: #FF0000">  0.06 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 403</span> <span style="color: #000000; background: #FFFFFF;">    Ad = 20.*<a href="file53.html">log10</a>((C/freq)./(4*pi.*los_mag));                % [nn32] </span><br/>               <span style="color: #A0A0A0"> 404</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 405</span> <span style="color: #228B22; background: #FFFFFF;">    % Load GPS SV antenna pattern data</span><br/>               <span style="color: #A0A0A0"> 406</span> <span style="color: #228B22; background: #FFFFFF;">    % Compute gain/attenuation of transmitting antenna pattern</span><br/><span style="color: #FF0000">  0.86 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 407</span> <span style="color: #000000; background: #FFFFFF;">    pattern = load(xmit_pattern);  % [x,2] </span><br/>               <span style="color: #A0A0A0"> 408</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 409</span> <span style="color: #228B22; background: #FFFFFF;">    % The anglemask is the max angle for which gain will be evaluated.  It is the minimum</span><br/>               <span style="color: #A0A0A0"> 410</span> <span style="color: #228B22; background: #FFFFFF;">    % of the max defined angle for the antenna pattern and the input "mask".</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 411</span> <span style="color: #000000; background: #FFFFFF;">    anglemask = min((max(pattern(:,1)))*pi/180,beta_t);  % [1,1] </span><br/>               <span style="color: #A0A0A0"> 412</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 413</span> <span style="color: #228B22; background: #FFFFFF;">    % Reshape the angle matrix into a [y,1] vector where y = nn*32</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 414</span> <span style="color: #000000; background: #FFFFFF;">    size1 = size(alpha_t,1); </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 415</span> <span style="color: #000000; background: #FFFFFF;">    size2 = size(alpha_t,2); </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 416</span> <span style="color: #000000; background: #FFFFFF;">    angle_vector = reshape(alpha_t,size1*size2,1); </span><br/>               <span style="color: #A0A0A0"> 417</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 418</span> <span style="color: #228B22; background: #FFFFFF;">    % Interpolate to input angles</span><br/><span style="color: #FF0000">  1.75 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 419</span> <span style="color: #000000; background: #FFFFFF;">    g1 = <a href="file62.html">interp1</a>((pattern(:,1))*pi/180,pattern(:,2),angle_vector,'spline'); </span><br/>               <span style="color: #A0A0A0"> 420</span> <span style="color: #228B22; background: #FFFFFF;">    % Remove gains computed for invalid angles</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 421</span> <span style="color: #000000; background: #FFFFFF;">    g1(angle_vector&gt;anglemask) = -100; </span><br/>               <span style="color: #A0A0A0"> 422</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 423</span> <span style="color: #000000; background: #FFFFFF;">    At = reshape(g1,size1,size2);                           % [nn,32] </span><br/>               <span style="color: #A0A0A0"> 424</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 425</span> <span style="color: #228B22; background: #FFFFFF;">    % Load receiving antenna pattern data</span><br/>               <span style="color: #A0A0A0"> 426</span> <span style="color: #228B22; background: #FFFFFF;">    % Compute gain/attenuation of receiving antenna pattern</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 427</span> <span style="color: #000000; background: #FFFFFF;">    if num_ant == 0            % Omnidirectional antenna </span><br/>               <span style="color: #A0A0A0"> 428</span> <span style="color: #A0A0A0; background: #FFFFFF;">        Ar = zeros(size(alpha_r));                          % [nn,32]</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 429</span> <span style="color: #228B22; background: #FFFFFF;">    else </span><br/><span style="color: #FF0000">  0.55 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 430</span> <span style="color: #000000; background: #FFFFFF;">        pattern = load(rec_pattern{ANT});  % [x,2] </span><br/>               <span style="color: #A0A0A0"> 431</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 432</span> <span style="color: #228B22; background: #FFFFFF;">        % The anglemask is the max angle for which gain will be evaluated.  It is the minimum</span><br/>               <span style="color: #A0A0A0"> 433</span> <span style="color: #228B22; background: #FFFFFF;">        % of the max defined angle for the antenna pattern and the input "mask".</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 434</span> <span style="color: #000000; background: #FFFFFF;">        anglemask = min((max(pattern(:,1)))*pi/180,beta_r);  % [1,1] </span><br/>               <span style="color: #A0A0A0"> 435</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 436</span> <span style="color: #228B22; background: #FFFFFF;">        % Reshape the angle matrix into a [y,1] vector where y = nn*32</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 437</span> <span style="color: #000000; background: #FFFFFF;">        size1 = size(alpha_r,1); </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 438</span> <span style="color: #000000; background: #FFFFFF;">        size2 = size(alpha_r,2); </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 439</span> <span style="color: #000000; background: #FFFFFF;">        angle_vector = reshape(alpha_r,size1*size2,1); </span><br/>               <span style="color: #A0A0A0"> 440</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 441</span> <span style="color: #228B22; background: #FFFFFF;">        % Interpolate to input angles</span><br/><span style="color: #FF0000">  1.55 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 442</span> <span style="color: #000000; background: #FFFFFF;">        g1 = <a href="file62.html">interp1</a>((pattern(:,1))*pi/180,pattern(:,2),angle_vector,'spline'); </span><br/>               <span style="color: #A0A0A0"> 443</span> <span style="color: #228B22; background: #FFFFFF;">        % Remove gains computed for invalid angles</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 444</span> <span style="color: #000000; background: #FFFFFF;">        g1(angle_vector&gt;anglemask) = -100; </span><br/>               <span style="color: #A0A0A0"> 445</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 446</span> <span style="color: #000000; background: #FFFFFF;">        Ar = reshape(g1,size1,size2); </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 447</span> <span style="color: #000000; background: #FFFFFF;">    end </span><br/>               <span style="color: #A0A0A0"> 448</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 449</span> <span style="color: #000000; background: #FFFFFF;">    AP = P_sv + At + Ad + Ae;                                % [nn,32] </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 450</span> <span style="color: #000000; background: #FFFFFF;">    RP = AP + Ar + As;                                      % [nn,32] </span><br/><span style="color: #FF0000">  0.04 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 451</span> <span style="color: #000000; background: #FFFFFF;">    CN0 = RP - (10*<a href="file53.html">log10</a>(Ts)) + 228.6 + Nf + L;             % [nn,32] </span><br/>               <span style="color: #A0A0A0"> 452</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 453</span> <span style="color: #228B22; background: #FFFFFF;">    %%   CN0 = (RP - (10*log10(Ts)) + 228.6 + Nf + L).*vis_beta;  % (1,mm)</span><br/>               <span style="color: #A0A0A0"> 454</span> <span style="color: #228B22; background: #FFFFFF;">    %  'vis_beta' zeros out meaningless signal levels, for which the</span><br/>               <span style="color: #A0A0A0"> 455</span> <span style="color: #228B22; background: #FFFFFF;">    %  antenna models are not valid</span><br/><a name="Line456"></a><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 456</span> <span style="color: #000000; background: #FFFFFF;">    S = RP + Ga + Ac;                                       % [nn,32] </span><br/>               <span style="color: #A0A0A0"> 457</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 458</span> <span style="color: #228B22; background: #FFFFFF;">    %  Set prns visible if CN0 is above acquisition/tracking threshold</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 459</span> <span style="color: #000000; background: #FFFFFF;">    vis_CN0 = CN0 &gt;= CN0_lim;                               % [nn,32] </span><br/>               <span style="color: #A0A0A0"> 460</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 461</span> <span style="color: #228B22; background: #FFFFFF;">    %  OUTPUT PARAMETERS</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 462</span> <span style="color: #000000; background: #FFFFFF;">    Halpha_r = alpha_r';             % [32,nn] </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 463</span> <span style="color: #000000; background: #FFFFFF;">    Hvis_beta = vis_beta';             % [32,nn] </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 464</span> <span style="color: #000000; background: #FFFFFF;">    Hvis_CN0 = vis_CN0';             % [32,nn] </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 465</span> <span style="color: #000000; background: #FFFFFF;">    HCN0 = CN0';             % [32,nn] </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 466</span> <span style="color: #000000; background: #FFFFFF;">    HAd = Ad';             % [32,nn] </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 467</span> <span style="color: #000000; background: #FFFFFF;">    HAr = Ar';             % [32,nn] </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 468</span> <span style="color: #000000; background: #FFFFFF;">    HAP = AP';             % [32,nn] </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 469</span> <span style="color: #000000; background: #FFFFFF;">    HRP = RP';             % [32,nn] </span><br/>               <span style="color: #A0A0A0"> 470</span> <span style="color: #228B22; background: #FFFFFF;">    % Note: this variable can be used to pass out other values as well</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 471</span> <span style="color: #000000; background: #FFFFFF;">    Hspare = At';             % [32,nn] </span><br/>               <span style="color: #A0A0A0"> 472</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 473</span> <span style="color: #228B22; background: #FFFFFF;">    % Mask undefined values for SV dependent parameters using (Health,</span><br/>               <span style="color: #A0A0A0"> 474</span> <span style="color: #228B22; background: #FFFFFF;">    %  Earth blockage, and xmit antennna masks)</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 475</span> <span style="color: #000000; background: #FFFFFF;">    VIS_sv = vis_beta_t' &amp; Hvis_earth &amp; health';             % [32,nn] </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 476</span> <span style="color: #000000; background: #FFFFFF;">    HAd(~VIS_sv) = -300;             % [32,nn] </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 477</span> <span style="color: #000000; background: #FFFFFF;">    HRP(~VIS_sv) = -300;             % [32,nn] </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 478</span> <span style="color: #000000; background: #FFFFFF;">    HAP(~VIS_sv) = -300;             % [32,nn] </span><br/>               <span style="color: #A0A0A0"> 479</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 480</span> <span style="color: #228B22; background: #FFFFFF;">    % Mask undefined values for Antenna dependent parameters using</span><br/>               <span style="color: #A0A0A0"> 481</span> <span style="color: #228B22; background: #FFFFFF;">    % (Health, Earth blockage, and both antennna masks)</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 482</span> <span style="color: #000000; background: #FFFFFF;">    VIS_ant = vis_beta' &amp; Hvis_earth &amp; health';             % [32,nn] </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 483</span> <span style="color: #000000; background: #FFFFFF;">    HCN0(~VIS_ant) = -300;             % [32,nn] </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 484</span> <span style="color: #000000; background: #FFFFFF;">    Hspare(~VIS_ant) = -300;             % [32,nn] </span><br/>               <span style="color: #A0A0A0"> 485</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 486</span> <span style="color: #000000; background: #FFFFFF;">    instring = {Halpha_r,Hvis_beta,Hvis_CN0,HCN0,HAd,HAr,HAP,HRP,Hspare}; </span><br/><span style="color: #FF0000">  0.16 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 487</span> <span style="color: #000000; background: #FFFFFF;">    outstring = {sprintf('H%dalpha_r',ANT),sprintf('H%dvis_beta',ANT),... </span><br/>               <span style="color: #A0A0A0"> 488</span> <span style="color: #000000; background: #FFFFFF;">        sprintf('H%dvis_CN0',ANT),sprintf('H%dCN0',ANT),'HAd',...</span><br/>               <span style="color: #A0A0A0"> 489</span> <span style="color: #000000; background: #FFFFFF;">        sprintf('H%dAr',ANT),'HAP',sprintf('H%dRP',ANT),sprintf('H%dspare',ANT)};</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 490</span> <span style="color: #000000; background: #FFFFFF;">    for nstr=1:length(instring) </span><br/><span style="color: #FF0000">  2.01 </span><span style="color: #0000FF">  12978 </span><span style="color: #000000; font-weight: bold"> 491</span> <span style="color: #000000; background: #FFFFFF;">        eval([outstring{nstr},' = instring{',<a href="file63.html">num2str</a>(nstr),'};']); </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">  12978 </span><span style="color: #000000; font-weight: bold"> 492</span> <span style="color: #000000; background: #FFFFFF;">    end </span><br/>               <span style="color: #A0A0A0"> 493</span> <span style="color: #228B22; background: #FFFFFF;">    % Names of variables to be saved</span><br/><a name="Line494"></a><span style="color: #FF0000">  0.07 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 494</span> <span style="color: #000000; background: #FFFFFF;">    variable_str = [variable_str,sprintf('H%dalpha_r H%dvis_beta H%dvis_CN0 H%dCN0 HAd H%dAr HAP H%dRP H%dspare ',ANT*ones(1,7))]; </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 495</span> <span style="color: #000000; background: #FFFFFF;">end </span><br/>               <span style="color: #A0A0A0"> 496</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 497</span> <span style="color: #228B22; background: #FFFFFF;">%% Initialize - Combine results across multiple antennas</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 498</span> <span style="color: #000000; background: #FFFFFF;">HVIS = zeros(size(health')); </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 499</span> <span style="color: #000000; background: #FFFFFF;">HCN0 = ones(size(health')).*-300; </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 500</span> <span style="color: #000000; background: #FFFFFF;">HRP = ones(size(health')).*-300; </span><br/><a name="Line501"></a><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 501</span> <span style="color: #000000; background: #FFFFFF;">HVISdyn = zeros(size(health')); </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 502</span> <span style="color: #000000; background: #FFFFFF;">HVIScases={'HVIS','HVISdyn'}; </span><br/><a name="Line503"></a><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 503</span> <span style="color: #000000; background: #FFFFFF;">betar_gss = 180*pi/180; %Aperature mask (half angle) used with rcv antennas in GSS simulator </span><br/>               <span style="color: #A0A0A0"> 504</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 505</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 506</span> <span style="color: #000000; background: #FFFFFF;">if num_ant &lt;= 1 </span><br/>               <span style="color: #A0A0A0"> 507</span> <span style="color: #A0A0A0; background: #FFFFFF;">    loop = 1;   % execute loop once for zero or one antennas</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 508</span> <span style="color: #228B22; background: #FFFFFF;">else </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 509</span> <span style="color: #000000; background: #FFFFFF;">    loop = num_ant;  % otherwise loop once for each additional antenna </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 510</span> <span style="color: #000000; background: #FFFFFF;">end </span><br/>               <span style="color: #A0A0A0"> 511</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 512</span> <span style="color: #228B22; background: #FFFFFF;">% Compute visibility and other derived parameters</span><br/>               <span style="color: #A0A0A0"> 513</span> <span style="color: #228B22; background: #FFFFFF;">% These can be re-computed quickly and therefore are not saved</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 514</span> <span style="color: #000000; background: #FFFFFF;">for ANT=1:loop </span><br/>               <span style="color: #A0A0A0"> 515</span> <span style="color: #228B22; background: #FFFFFF;">    % Compute visibility for each antenna</span><br/>               <span style="color: #A0A0A0"> 516</span> <span style="color: #228B22; background: #FFFFFF;">    % Visibility for the GSS simulator, takes the form:</span><br/>               <span style="color: #A0A0A0"> 517</span> <span style="color: #228B22; background: #FFFFFF;">    % HXvis_gss = Health &amp; Hvis_earth &amp; (HXalpha_r &lt;= betar_gss);</span><br/><span style="color: #FF0000">  0.21 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 518</span> <span style="color: #000000; background: #FFFFFF;">    eval(sprintf('H%dvis_gss = health'' &amp; Hvis_earth &amp; (H%dalpha_r &lt;= betar_gss);',ANT*ones(1,2))); </span><br/>               <span style="color: #A0A0A0"> 519</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 520</span> <span style="color: #228B22; background: #FFFFFF;">    % User elevation angle with respect to antenna boresite</span><br/>               <span style="color: #A0A0A0"> 521</span> <span style="color: #228B22; background: #FFFFFF;">    % Set non-existent/unhealthy SVs to -90 deg</span><br/><span style="color: #FF0000">  0.18 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 522</span> <span style="color: #000000; background: #FFFFFF;">    eval(sprintf('H%del = (pi/2) - H%dalpha_r;',ANT*ones(1,2)));    % (nn,32) </span><br/><span style="color: #FF0000">  0.17 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 523</span> <span style="color: #000000; background: #FFFFFF;">    eval(sprintf('H%del(~health'') = -pi/2;',ANT)); </span><br/>               <span style="color: #A0A0A0"> 524</span> <span style="color: #228B22; background: #FFFFFF;">    </span><br/>               <span style="color: #A0A0A0"> 525</span> <span style="color: #228B22; background: #FFFFFF;">    %- Compute azimuth wrt local-NED (zero az at north)</span><br/>               <span style="color: #A0A0A0"> 526</span> <span style="color: #228B22; background: #FFFFFF;">    % Eventually, should compute azimuth with respect to local antenna orientation, not simply wrt ned</span><br/>               <span style="color: #A0A0A0"> 527</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 528</span> <span style="color: #000000; background: #FFFFFF;">    nn = size(sat_pos,2); </span><br/>               <span style="color: #A0A0A0"> 529</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 530</span> <span style="color: #228B22; background: #FFFFFF;">    % Compute sat_pos in lla</span><br/><span style="color: #FF0000">  0.30 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 531</span> <span style="color: #000000; background: #FFFFFF;">    [sat_lla(1,:),sat_lla(2,:),sat_lla(3,:)] = <a href="file65.html">ecef2LLA</a>(sat_pos); </span><br/>               <span style="color: #A0A0A0"> 532</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 533</span> <span style="color: #228B22; background: #FFFFFF;">    % Initialize</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 534</span> <span style="color: #000000; background: #FFFFFF;">    Haz = zeros(32,nn); </span><br/>               <span style="color: #A0A0A0"> 535</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 536</span> <span style="color: #228B22; background: #FFFFFF;">    % Compute los vectors to each gps satellite</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 537</span> <span style="color: #000000; background: #FFFFFF;">    for i = 1:32 </span><br/><span style="color: #FF0000">  0.21 </span><span style="color: #0000FF">  46144 </span><span style="color: #000000; font-weight: bold"> 538</span> <span style="color: #000000; background: #FFFFFF;">        Hulos = reshape(HuLOS(:,:,i),3,nn); </span><br/><span style="color: #FF0000"> 13.88 </span><span style="color: #0000FF">  46144 </span><span style="color: #000000; font-weight: bold"> 539</span> <a name="Line539"></a><span style="color: #000000; background: #FFAAAA;">        los_ned = <a href="file39.html">ecef2NED</a>(Hulos',sat_lla')'; </span><br/>               <span style="color: #A0A0A0"> 540</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 541</span> <span style="color: #228B22; background: #FFFFFF;">        % component of los in local horizonal plane (north and east)</span><br/><span style="color: #FF0000">  0.36 </span><span style="color: #0000FF">  46144 </span><span style="color: #000000; font-weight: bold"> 542</span> <span style="color: #000000; background: #FFFFFF;">        los_ned_ip = [los_ned(1,:);los_ned(2,:);zeros(size(los_ned(3,:)))]; </span><br/><span style="color: #FF0000">  0.11 </span><span style="color: #0000FF">  46144 </span><span style="color: #000000; font-weight: bold"> 543</span> <span style="color: #000000; background: #FFFFFF;">        los_ned_ip_mag = sqrt(los_ned_ip(1,:).^2 + los_ned_ip(2,:).^2 + los_ned_ip(3,:).^2); </span><br/>               <span style="color: #A0A0A0"> 544</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/><span style="color: #FF0000">  0.07 </span><span style="color: #0000FF">  46144 </span><span style="color: #000000; font-weight: bold"> 545</span> <span style="color: #000000; background: #FFFFFF;">        if sum(los_ned_ip_mag) ~= 0 </span><br/>               <span style="color: #A0A0A0"> 546</span> <span style="color: #228B22; background: #FFFFFF;">            % Compute azimuth as angle between los_ned_ip and north unit vector</span><br/><span style="color: #FF0000">  1.39 </span><span style="color: #0000FF">  46144 </span><span style="color: #000000; font-weight: bold"> 547</span> <span style="color: #000000; background: #FFFFFF;">            az_mag = acos(<a href="file52.html">dot</a>(los_ned_ip,[1;0;0]*ones(1,size(los_ned_ip,2)))./los_ned_ip_mag); </span><br/>               <span style="color: #A0A0A0"> 548</span> <span style="color: #228B22; background: #FFFFFF;">            % Sign of azimuth should be equal to the sign of the east component</span><br/>               <span style="color: #A0A0A0"> 549</span> <span style="color: #228B22; background: #FFFFFF;">            % Positive for clockwise from north, negative for counter-clockwise from north</span><br/><span style="color: #FF0000">  0.04 </span><span style="color: #0000FF">  46144 </span><span style="color: #000000; font-weight: bold"> 550</span> <span style="color: #000000; background: #FFFFFF;">            Haz(i,:) = sign(los_ned_ip(2,:)).*az_mag; </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">  46144 </span><span style="color: #000000; font-weight: bold"> 551</span> <span style="color: #000000; background: #FFFFFF;">        end </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">  46144 </span><span style="color: #000000; font-weight: bold"> 552</span> <span style="color: #000000; background: #FFFFFF;">    end </span><br/>               <span style="color: #A0A0A0"> 553</span> <span style="color: #228B22; background: #FFFFFF;">    </span><br/>               <span style="color: #A0A0A0"> 554</span> <span style="color: #228B22; background: #FFFFFF;">    % Compute visibility based on dynamic CN0 threshold (imposes limit on range of simultaneous C/No values)</span><br/>               <span style="color: #A0A0A0"> 555</span> <span style="color: #228B22; background: #FFFFFF;">    % Compute maximum CN0 for VISIBLE SV at each time step</span><br/>               <span style="color: #A0A0A0"> 556</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 557</span> <span style="color: #228B22; background: #FFFFFF;">    % Compute normal visibility for each antenna</span><br/><span style="color: #FF0000">  0.05 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 558</span> <span style="color: #000000; background: #FFFFFF;">    finalstring = sprintf('H%dvis = health''.*Hvis_earth.*H%dvis_beta.*Hvis_atm.*H%dvis_CN0',ANT*ones(1,3)); </span><br/>               <span style="color: #A0A0A0"> 559</span> <span style="color: #228B22; background: #FFFFFF;">    %   H1vis = Health.*Hvis_earth.*H1vis_beta.*Hvis_atm.*H1vis_CN0;   % (32,mm)</span><br/><span style="color: #FF0000">  0.22 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 560</span> <span style="color: #000000; background: #FFFFFF;">    eval([finalstring,';']); </span><br/>               <span style="color: #A0A0A0"> 561</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/><span style="color: #FF0000">  0.17 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 562</span> <span style="color: #000000; background: #FFFFFF;">    eval(sprintf('maxCN0 = max(H%dvis.*H%dCN0);',ANT*ones(1,2))); </span><br/>               <span style="color: #A0A0A0"> 563</span> <span style="color: #228B22; background: #FFFFFF;">    % Compute the visibility based on the dynamic CN0 limit at each time step</span><br/><a name="Line564"></a><span style="color: #FF0000">  0.01 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 564</span> <span style="color: #000000; background: #FFFFFF;">    CN0_lim_dyn = ones(32,1)*max(CN0_lim,(maxCN0 - dyn_range)); </span><br/><span style="color: #FF0000">  0.15 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 565</span> <span style="color: #000000; background: #FFFFFF;">    eval(sprintf('H%dvis_CN0dyn = H%dCN0 &gt;= CN0_lim_dyn;',ANT*ones(1,2))); </span><br/><span style="color: #FF0000">  0.03 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 566</span> <span style="color: #000000; background: #FFFFFF;">    clear maxCN0 CN0_lim_dyn </span><br/>               <span style="color: #A0A0A0"> 567</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 568</span> <span style="color: #228B22; background: #FFFFFF;">    % Compute visibility for each antenna using dynamic tracking threshold</span><br/><span style="color: #FF0000">  0.04 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 569</span> <span style="color: #000000; background: #FFFFFF;">    finalstring = sprintf('H%dvisdyn = health''.*Hvis_earth.*H%dvis_beta.*Hvis_atm.*H%dvis_CN0dyn',ANT*ones(1,3)); </span><br/>               <span style="color: #A0A0A0"> 570</span> <span style="color: #228B22; background: #FFFFFF;">    %   H1visdyn = Health.*Hvis_earth.*H1vis_beta.*Hvis_atm.*H1vis_CN0dyn;   % (32,mm)</span><br/><span style="color: #FF0000">  0.19 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 571</span> <span style="color: #000000; background: #FFFFFF;">    eval([finalstring,';']); </span><br/>               <span style="color: #A0A0A0"> 572</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/><span style="color: #FF0000">  0.13 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 573</span> <span style="color: #000000; background: #FFFFFF;">    eval(sprintf('HVIS = HVIS | H%dvis;',ANT)); </span><br/><span style="color: #FF0000">  0.13 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 574</span> <span style="color: #000000; background: #FFFFFF;">    eval(sprintf('HVISdyn = HVISdyn | H%dvis_CN0dyn;',ANT)); </span><br/><a name="Line575"></a><span style="color: #FF0000">  0.50 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 575</span> <span style="color: #000000; background: #FFFFFF;">    HVIScases=eval(sprintf('<a href="file67.html">union</a>(HVIScases, ''H%dvis'');',ANT)); </span><br/><span style="color: #FF0000">  0.45 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 576</span> <span style="color: #000000; background: #FFFFFF;">    HVIScases=eval(sprintf('<a href="file67.html">union</a>(HVIScases, ''H%dvis_CN0dyn'');',ANT)); </span><br/>               <span style="color: #A0A0A0"> 577</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 578</span> <span style="color: #228B22; background: #FFFFFF;">    % Compute composite RP, C/No across all simulated antennas (take the max C/No)</span><br/><span style="color: #FF0000">  0.15 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 579</span> <span style="color: #000000; background: #FFFFFF;">    eval(sprintf('HRP = max(HRP,H%dRP);',ANT)); </span><br/><span style="color: #FF0000">  0.14 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 580</span> <span style="color: #000000; background: #FFFFFF;">    eval(sprintf('HCN0 = max(HCN0,H%dCN0);',ANT)); </span><br/>               <span style="color: #A0A0A0"> 581</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 582</span> <span style="color: #000000; background: #FFFFFF;">end </span><br/>               <span style="color: #A0A0A0"> 583</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 584</span> <span style="color: #228B22; background: #FFFFFF;">%% Apply Aquisition constraint to visibility (HCNO with HVIS and HVISdyn)</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 585</span> <span style="color: #000000; background: #FFFFFF;">for HVc=1:length(HVIScases)     </span><br/><span style="color: #FF0000">  0.30 </span><span style="color: #0000FF">   4326 </span><span style="color: #000000; font-weight: bold"> 586</span> <span style="color: #000000; background: #FFFFFF;">    VISCN0=eval(['HCN0.*' HVIScases{HVc}]); </span><br/><span style="color: #FF0000">  0.01 </span><span style="color: #0000FF">   4326 </span><span style="color: #000000; font-weight: bold"> 587</span> <span style="color: #000000; background: #FFFFFF;">    VISCN0acq=zeros(size(VISCN0)); </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   4326 </span><span style="color: #000000; font-weight: bold"> 588</span> <span style="color: #000000; background: #FFFFFF;">    for n=1:size(VISCN0,1) </span><br/><span style="color: #FF0000">  0.42 </span><span style="color: #0000FF"> 138432 </span><span style="color: #000000; font-weight: bold"> 589</span> <span style="color: #000000; background: #FFFFFF;">        Vacq=find(VISCN0(n,:)&gt;=CN0_acq); </span><br/><span style="color: #FF0000">  7.88 </span><span style="color: #0000FF"> 138432 </span><span style="color: #000000; font-weight: bold"> 590</span> <a name="Line590"></a><span style="color: #000000; background: #FFD4D4;">        Vzero=<a href="file67.html">union</a>(find(VISCN0(n,:)==0),size(VISCN0,2)+1); </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF"> 138432 </span><span style="color: #000000; font-weight: bold"> 591</span> <span style="color: #000000; background: #FFFFFF;">        if isempty(Vacq) </span><br/><span style="color: #FF0000">  0.23 </span><span style="color: #0000FF"> 120303 </span><span style="color: #000000; font-weight: bold"> 592</span> <span style="color: #000000; background: #FFFFFF;">            VStartIndex=[]; </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">  18129 </span><span style="color: #000000; font-weight: bold"> 593</span> <span style="color: #228B22; background: #FFFFFF;">        else </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">  18129 </span><span style="color: #000000; font-weight: bold"> 594</span> <span style="color: #000000; background: #FFFFFF;">            VStartIndex=1; </span><br/><span style="color: #FF0000">  0.02 </span><span style="color: #0000FF">  18129 </span><span style="color: #000000; font-weight: bold"> 595</span> <span style="color: #000000; background: #FFFFFF;">        end </span><br/><span style="color: #FF0000">  0.31 </span><span style="color: #0000FF"> 138432 </span><span style="color: #000000; font-weight: bold"> 596</span> <span style="color: #000000; background: #FFFFFF;">        while ~isempty(VStartIndex) </span><br/><span style="color: #FF0000">  0.03 </span><span style="color: #0000FF">  18129 </span><span style="color: #000000; font-weight: bold"> 597</span> <span style="color: #000000; background: #FFFFFF;">            VStart=Vacq(VStartIndex); </span><br/><span style="color: #FF0000">  0.14 </span><span style="color: #0000FF">  18129 </span><span style="color: #000000; font-weight: bold"> 598</span> <span style="color: #000000; background: #FFFFFF;">            VStop=Vzero(find(Vzero&gt;=VStart,1,'first'))-1; </span><br/><span style="color: #FF0000">  0.18 </span><span style="color: #0000FF">  18129 </span><span style="color: #000000; font-weight: bold"> 599</span> <span style="color: #000000; background: #FFFFFF;">            VISCN0acq(n,VStart:VStop)=VISCN0(n,VStart:VStop); </span><br/><span style="color: #FF0000">  0.35 </span><span style="color: #0000FF">  18129 </span><span style="color: #000000; font-weight: bold"> 600</span> <span style="color: #000000; background: #FFFFFF;">            VStartIndex=VStartIndex+find((Vacq(VStartIndex+1:end)-Vacq(VStartIndex:end-1))&gt;1,1,'first'); </span><br/><span style="color: #FF0000">  0.07 </span><span style="color: #0000FF">  18129 </span><span style="color: #000000; font-weight: bold"> 601</span> <span style="color: #000000; background: #FFFFFF;">        end </span><br/><span style="color: #FF0000">  0.15 </span><span style="color: #0000FF"> 138432 </span><span style="color: #000000; font-weight: bold"> 602</span> <span style="color: #000000; background: #FFFFFF;">    end </span><br/><span style="color: #FF0000">  0.36 </span><span style="color: #0000FF">   4326 </span><span style="color: #000000; font-weight: bold"> 603</span> <span style="color: #000000; background: #FFFFFF;">    eval([HVIScases{HVc} '=(VISCN0acq~=0);']); </span><br/><span style="color: #FF0000">  0.35 </span><span style="color: #0000FF">   4326 </span><span style="color: #000000; font-weight: bold"> 604</span> <span style="color: #000000; background: #FFFFFF;">    clear n VISCNO VISCN0acq Vacq Vzero VStartIndex VStart VStop </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   4326 </span><span style="color: #000000; font-weight: bold"> 605</span> <span style="color: #000000; background: #FFFFFF;">end </span><br/>               <span style="color: #A0A0A0"> 606</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 607</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/><a name="Line608"></a><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 608</span> <span style="color: #000000; background: #FFFFFF;">HRR = sqrt(sum(sat_pos.^2));   % [1,nn]  magnitude of user vehicle position vector </span><br/>               <span style="color: #A0A0A0"> 609</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/><span style="color: #FF0000">  0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 610</span> <span style="color: #000000; background: #FFFFFF;">HVIS = HVIS.*health';  % Make sure all non-existent SVs are not visible </span><br/><a name="Line611"></a><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 611</span> <span style="color: #000000; background: #FFFFFF;">HCN0(~health') = -300;  % Set C/No for all non-existent SVs to -300 </span><br/><a name="Line612"></a><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 612</span> <span style="color: #000000; background: #FFFFFF;">HRP(~health') = -300;  % Set RP for all non-existent SVs to -300 </span><br/>               <span style="color: #A0A0A0"> 613</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 614</span> <span style="color: #228B22; background: #FFFFFF;">%% Create Outputs</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 615</span> <span style="color: #000000; background: #FFFFFF;">y=[]; </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 616</span> <span style="color: #000000; background: #FFFFFF;">H=[]; </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 617</span> <span style="color: #000000; background: #FFFFFF;">nancheck=[NaN 0]; </span><br/>               <span style="color: #A0A0A0"> 618</span> <span style="color: #228B22; background: #FFFFFF;">% NEED TO INCORPORATE range.m &amp; doppler.m</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 619</span> <span style="color: #000000; background: #FFFFFF;">for n=1:size(Hrange,1) </span><br/>               <span style="color: #A0A0A0"> 620</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">  23072 </span><span style="color: #000000; font-weight: bold"> 621</span> <span style="color: #000000; background: #FFFFFF;">    if( useRange ) </span><br/><a name="Line622"></a><span style="color: #FF0000">  0.17 </span><span style="color: #0000FF">  23072 </span><span style="color: #000000; font-weight: bold"> 622</span> <span style="color: #000000; background: #FFFFFF;">        y = [y; Hrange(n,:)+nancheck(HVIS(n,:)+1)]; </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">  23072 </span><span style="color: #000000; font-weight: bold"> 623</span> <span style="color: #000000; background: #FFFFFF;">    end </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">  23072 </span><span style="color: #000000; font-weight: bold"> 624</span> <span style="color: #000000; background: #FFFFFF;">    if( useDoppler ) </span><br/><a name="Line625"></a>               <span style="color: #A0A0A0"> 625</span> <span style="color: #A0A0A0; background: #FFFFFF;">        y = [y; Hdoppler(n,:)+nancheck(HVIS(n,:)+1)];</span><br/>               <span style="color: #A0A0A0"> 626</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/>               <span style="color: #A0A0A0"> 627</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">  23072 </span><span style="color: #000000; font-weight: bold"> 628</span> <span style="color: #000000; background: #FFFFFF;">    if nargout &gt; 1, </span><br/><span style="color: #FF0000">  0.04 </span><span style="color: #0000FF">  23072 </span><span style="color: #000000; font-weight: bold"> 629</span> <span style="color: #000000; background: #FFFFFF;">        dr = los_3d(:,:,n); %pos diff vector </span><br/><span style="color: #FF0000">  0.08 </span><span style="color: #0000FF">  23072 </span><span style="color: #000000; font-weight: bold"> 630</span> <span style="color: #000000; background: #FFFFFF;">        dv = gps_vel(:,:,n) - vuser_3d(:,:,n); %vel diff vector </span><br/><span style="color: #FF0000">  0.58 </span><span style="color: #0000FF">  23072 </span><span style="color: #000000; font-weight: bold"> 631</span> <span style="color: #000000; background: #FFFFFF;">        udr = <a href="file69.html">unit</a>(dr); </span><br/><span style="color: #FF0000">  0.15 </span><span style="color: #0000FF">  23072 </span><span style="color: #000000; font-weight: bold"> 632</span> <span style="color: #000000; background: #FFFFFF;">        rho = sqrt(sum(dr.^2)); </span><br/><span style="color: #FF0000">  0.68 </span><span style="color: #0000FF">  23072 </span><span style="color: #000000; font-weight: bold"> 633</span> <span style="color: #000000; background: #FFFFFF;">        Hvv = <a href="file70.html">shiftdim</a>(udr,-1); </span><br/><span style="color: #FF0000">  0.62 </span><span style="color: #0000FF">  23072 </span><span style="color: #000000; font-weight: bold"> 634</span> <span style="color: #000000; background: #FFFFFF;">        Hrr = <a href="file70.html">shiftdim</a>(udr,-1); </span><br/><span style="color: #FF0000">  2.86 </span><span style="color: #0000FF">  23072 </span><span style="color: #000000; font-weight: bold"> 635</span> <a name="Line635"></a><span style="color: #000000; background: #FFF0F0;">        Hvr = <a href="file70.html">shiftdim</a>(dv.*<a href="file40.html">repmat</a>(1./rho,3,1) ... </span><br/>               <span style="color: #A0A0A0"> 636</span> <span style="color: #000000; background: #FFF0F0;">            - dr.*repmat(dot(dr,dv)./rho.^3,3,1),-1);</span><br/><span style="color: #FF0000">  0.05 </span><span style="color: #0000FF">  23072 </span><span style="color: #000000; font-weight: bold"> 637</span> <span style="color: #000000; background: #FFFFFF;">        Hrv = zeros(size(Hvr)); </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">  23072 </span><span style="color: #000000; font-weight: bold"> 638</span> <span style="color: #000000; background: #FFFFFF;">        if( useRange ) </span><br/><a name="Line639"></a><span style="color: #FF0000">  0.15 </span><span style="color: #0000FF">  23072 </span><span style="color: #000000; font-weight: bold"> 639</span> <span style="color: #000000; background: #FFFFFF;">            H = [H; [Hrr Hrv] ]; </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">  23072 </span><span style="color: #000000; font-weight: bold"> 640</span> <span style="color: #000000; background: #FFFFFF;">        end </span><br/><span style="color: #FF0000">  0.03 </span><span style="color: #0000FF">  23072 </span><span style="color: #000000; font-weight: bold"> 641</span> <span style="color: #000000; background: #FFFFFF;">        if( useDoppler ) </span><br/><a name="Line642"></a>               <span style="color: #A0A0A0"> 642</span> <span style="color: #A0A0A0; background: #FFFFFF;">            H = [H; [Hvr Hvv] ];</span><br/>               <span style="color: #A0A0A0"> 643</span> <span style="color: #A0A0A0; background: #FFFFFF;">        end</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">  23072 </span><span style="color: #000000; font-weight: bold"> 644</span> <span style="color: #000000; background: #FFFFFF;">    end </span><br/><span style="color: #FF0000">  0.06 </span><span style="color: #0000FF">  23072 </span><span style="color: #000000; font-weight: bold"> 645</span> <span style="color: #000000; background: #FFFFFF;">end </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 646</span> <span style="color: #000000; background: #FFFFFF;">if nargout &gt; 2, </span><br/><span style="color: #FF0000">  0.08 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 647</span> <span style="color: #000000; background: #FFFFFF;">    R = <a href="file40.html">repmat</a>(sigma.^2,[1,1,length(t)]); </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 648</span> <span style="color: #000000; background: #FFFFFF;">end </span><br/>               <span style="color: #A0A0A0"> 649</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold"> 650</span> <span style="color: #000000; background: #FFFFFF;">end </span><br/></pre><p><p>Other subfunctions in this file are not included in this listing.</body></html>