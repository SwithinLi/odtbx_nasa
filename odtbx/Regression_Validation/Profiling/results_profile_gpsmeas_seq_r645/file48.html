<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><link rel="stylesheet" href="file:///C:\Program Files\MATLAB\R2008a\toolbox\matlab\codetools\matlab-report-styles.css" type="text/css" /><title>Function details for comp_bs_3d</title><link rel="stylesheet" href="file:///C:\Program Files\MATLAB\R2008a\toolbox\matlab\codetools\matlab-report-styles.css" type="text/css" /></head><body bgcolor="#F8F8F8"><strong>This is a static copy of a profile report</strong><p><a href="file0.html">Home</a><p><span style="font-size:14pt; background:#FFE4B0">comp_bs_3d (721 calls, 0.054 sec)</span><br/><i>Generated 29-May-2009 12:20:29 using cpu time.</i><br/>M-function in file C:\Users\abrown\Projects\ODTBX\matlab\trunk\ODTBX_Source\comp_bs_3d.m<br/>[Copy to new window for comparing multiple runs]<div class="grayline"/><div class="grayline"/><strong>Parents</strong> (calling functions)<br/><p><table border=0 cellspacing=0 cellpadding=6><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Function Name</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Function Type</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Calls</td></tr><tr><td class="td-linebottomrt"><a href="file20.html">gpsmeas</a></td><td class="td-linebottomrt">M-function</td><td class="td-linebottomrt">721</td></tr></table><div class="grayline"/><strong>Lines where the most time was spent</strong><br/> <p><table border=0 cellspacing=0 cellpadding=6><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Line Number</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Code</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Calls</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Total Time</td><td class="td-linebottomrt" bgcolor="#F0F0F0">% Time</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Time Plot</td></tr><tr><td class="td-linebottomrt"><a href="#Line69">69</a></td><td class="td-linebottomrt"><pre>mag_r_sat = sqrt(sum(r_sat.^2)...</pre></td><td class="td-linebottomrt">1442</td><td class="td-linebottomrt">0.011 s</td><td class="td-linebottomrt" class="td-linebottomrt">20.7%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2008a\toolbox\matlab\codetools\private\one-pixel.gif" width=21 height=10></td></tr><tr><td class="td-linebottomrt"><a href="#Line65">65</a></td><td class="td-linebottomrt"><pre>for ii = 1:num_ant</pre></td><td class="td-linebottomrt">721</td><td class="td-linebottomrt">0.006 s</td><td class="td-linebottomrt" class="td-linebottomrt">10.6%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2008a\toolbox\matlab\codetools\private\one-pixel.gif" width=11 height=10></td></tr><tr><td class="td-linebottomrt"><a href="#Line48">48</a></td><td class="td-linebottomrt"><pre>boresite = zeros(3,length(time...</pre></td><td class="td-linebottomrt">721</td><td class="td-linebottomrt">0.006 s</td><td class="td-linebottomrt" class="td-linebottomrt">10.5%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2008a\toolbox\matlab\codetools\private\one-pixel.gif" width=10 height=10></td></tr><tr><td class="td-linebottomrt"><a href="#Line257">257</a></td><td class="td-linebottomrt"><pre>boresite(:,:,ii)=ant_bs;</pre></td><td class="td-linebottomrt">1442</td><td class="td-linebottomrt">0.004 s</td><td class="td-linebottomrt" class="td-linebottomrt">7.6%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2008a\toolbox\matlab\codetools\private\one-pixel.gif" width=8 height=10></td></tr><tr><td class="td-linebottomrt"><a href="#Line71">71</a></td><td class="td-linebottomrt"><pre>unit_r_sat = r_sat./[mag_r_sat...</pre></td><td class="td-linebottomrt">1442</td><td class="td-linebottomrt">0.003 s</td><td class="td-linebottomrt" class="td-linebottomrt">5.8%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2008a\toolbox\matlab\codetools\private\one-pixel.gif" width=6 height=10></td></tr><tr><td class="td-linebottomrt">All other lines</td><td class="td-linebottomrt">&nbsp;</td><td class="td-linebottomrt">&nbsp;</td><td class="td-linebottomrt">0.024 s</td><td class="td-linebottomrt">44.8%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2008a\toolbox\matlab\codetools\private\one-pixel.gif" width=45 height=10></td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Totals</td><td class="td-linebottomrt" bgcolor="#F0F0F0">&nbsp;</td><td class="td-linebottomrt" bgcolor="#F0F0F0">&nbsp;</td><td class="td-linebottomrt" bgcolor="#F0F0F0">0.054 s</td><td class="td-linebottomrt" bgcolor="#F0F0F0">100%</td><td class="td-linebottomrt" bgcolor="#F0F0F0">&nbsp;</td></tr></table><div class="grayline"/><b>Children</b> (called functions)<br/>No children<div class="grayline"/><strong>M-Lint results</strong><br/>No M-Lint messages.<div class="grayline"/><strong>Coverage results</strong><br/>[ Show coverage for parent directory ]<br/><table border=0 cellspacing=0 cellpadding=6><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Total lines in function</td><td class="td-linebottomrt">219</td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Non-code lines (comments, blank lines)</td><td class="td-linebottomrt">115</td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Code lines (lines that can run)</td><td class="td-linebottomrt">104</td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Code lines that did run</td><td class="td-linebottomrt">16</td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Code lines that did not run</td><td class="td-linebottomrt">88</td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Coverage (did run/can run)</td><td class="td-linebottomrt">15.38 %</td></tr></table><div class="grayline"/><b>Function listing</b><br/><pre> <span style="color: #FF0000; font-weight: bold; text-decoration: none">  time</span> <span style="color: #0000FF; font-weight: bold; text-decoration: none">  calls</span>  <span style="font-weight: bold; text-decoration: none">line</span><br/>               <span style="color: #A0A0A0">  40</span> <span style="color: #A0A0A0; background: #FFFFFF;">function [boresite] = comp_bs_3d(num_ant,time,r_sat,v_sat,pointing_ref,frame)</span><br/>               <span style="color: #A0A0A0">  41</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0">  42</span> <span style="color: #228B22; background: #FFFFFF;">%  Check for valid number of antennas</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold">  43</span> <span style="color: #000000; background: #FFFFFF;">if ~(num_ant==0 || num_ant==1 || num_ant==2 || num_ant==3 || num_ant==4) </span><br/>               <span style="color: #A0A0A0">  44</span> <span style="color: #A0A0A0; background: #FFFFFF;">   error('Number of antennas must be an integer between 0-4')</span><br/>               <span style="color: #A0A0A0">  45</span> <span style="color: #A0A0A0; background: #FFFFFF;">end</span><br/>               <span style="color: #A0A0A0">  46</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0">  47</span> <span style="color: #228B22; background: #FFFFFF;">%  Initialize boresite matrix</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold">  48</span> <a name="Line48"></a><span style="color: #000000; background: #FFB8B8;">boresite = zeros(3,length(time),num_ant); </span><br/>               <span style="color: #A0A0A0">  49</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold">  50</span> <span style="color: #000000; background: #FFF0F0;">if num_ant == 0 </span><br/>               <span style="color: #A0A0A0">  51</span> <span style="color: #228B22; background: #FFFFFF;">   %  Host vehicle position vectors (r_sat) passed as function input (sat_pos)</span><br/>               <span style="color: #A0A0A0">  52</span> <span style="color: #228B22; background: #FFFFFF;">   %  Compute magnitude of position vector, the radial distance to host vehicle</span><br/>               <span style="color: #A0A0A0">  53</span> <span style="color: #A0A0A0; background: #FFFFFF;">   mag_r_sat = sqrt(sum(r_sat.^2));                         % [1,nn]</span><br/>               <span style="color: #A0A0A0">  54</span> <span style="color: #228B22; background: #FFFFFF;">   %  Compute unit vectors corresponding to r_sat</span><br/>               <span style="color: #A0A0A0">  55</span> <span style="color: #A0A0A0; background: #FFFFFF;">   unit_r_sat = r_sat./[mag_r_sat;mag_r_sat;mag_r_sat;];    % [3,nn]</span><br/>               <span style="color: #A0A0A0">  56</span> <span style="color: #228B22; background: #FFFFFF;">   </span><br/>               <span style="color: #A0A0A0">  57</span> <span style="color: #228B22; background: #FFFFFF;">   %  Set boresites parallel to r_sat direction (zenith direction)</span><br/>               <span style="color: #A0A0A0">  58</span> <span style="color: #A0A0A0; background: #FFFFFF;">   ant_bs = unit_r_sat;                                   % [3,nn]</span><br/>               <span style="color: #A0A0A0">  59</span> <span style="color: #228B22; background: #FFFFFF;">   </span><br/>               <span style="color: #A0A0A0">  60</span> <span style="color: #228B22; background: #FFFFFF;">   %  Boresite is based on r_sat vector, so boresite is automatically in the</span><br/>               <span style="color: #A0A0A0">  61</span> <span style="color: #228B22; background: #FFFFFF;">   %  correct reference frame</span><br/>               <span style="color: #A0A0A0">  62</span> <span style="color: #A0A0A0; background: #FFFFFF;">   boresite = ant_bs;   </span><br/>               <span style="color: #A0A0A0">  63</span> <span style="color: #A0A0A0; background: #FFFFFF;">end</span><br/>               <span style="color: #A0A0A0">  64</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    721 </span><span style="color: #000000; font-weight: bold">  65</span> <a name="Line65"></a><span style="color: #000000; background: #FFB8B8;">for ii = 1:num_ant </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold">  66</span> <span style="color: #000000; background: #FFFFFF;">   if abs(pointing_ref(ii)) == 1   % Earth pointing s/c </span><br/>               <span style="color: #A0A0A0">  67</span> <span style="color: #228B22; background: #FFFFFF;">      %  Host vehicle position vectors (r_sat) passed as function input (sat_pos)</span><br/>               <span style="color: #A0A0A0">  68</span> <span style="color: #228B22; background: #FFFFFF;">      %  Compute magnitude of position vector, the radial distance to host vehicle</span><br/><span style="color: #FF0000">  0.01 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold">  69</span> <a name="Line69"></a><span style="color: #000000; background: #FF8080;">      mag_r_sat = sqrt(sum(r_sat.^2));                      % [1,nn] </span><br/>               <span style="color: #A0A0A0">  70</span> <span style="color: #228B22; background: #FFFFFF;">      %  Compute unit vectors corresponding to r_sat</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold">  71</span> <a name="Line71"></a><span style="color: #000000; background: #FFE2E2;">      unit_r_sat = r_sat./[mag_r_sat;mag_r_sat;mag_r_sat;]; % [3,nn] </span><br/>               <span style="color: #A0A0A0">  72</span> <span style="color: #228B22; background: #FFFFFF;">      </span><br/>               <span style="color: #A0A0A0">  73</span> <span style="color: #228B22; background: #FFFFFF;">      %  Set boresites parallel to r_sat direction if pointing_ref = 1</span><br/>               <span style="color: #A0A0A0">  74</span> <span style="color: #228B22; background: #FFFFFF;">      %  Set boresites anti-parallel to r_sat direction if pointing_ref = -1</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold">  75</span> <span style="color: #000000; background: #FFE2E2;">      ant_bs = unit_r_sat.*(pointing_ref(ii)/abs(pointing_ref(ii))); </span><br/>               <span style="color: #A0A0A0">  76</span> <span style="color: #228B22; background: #FFFFFF;">      </span><br/>               <span style="color: #A0A0A0">  77</span> <span style="color: #228B22; background: #FFFFFF;">      %  Boresite is based on r_sat vector, so boresite is automatically in the</span><br/>               <span style="color: #A0A0A0">  78</span> <span style="color: #228B22; background: #FFFFFF;">      %  correct reference frame</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold">  79</span> <span style="color: #000000; background: #FFFFFF;">   end </span><br/>               <span style="color: #A0A0A0">  80</span> <span style="color: #228B22; background: #FFFFFF;">   </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold">  81</span> <span style="color: #000000; background: #FFE2E2;">   if abs(pointing_ref(ii)) == 2   % Sun pointing s/c </span><br/>               <span style="color: #A0A0A0">  82</span> <span style="color: #228B22; background: #FFFFFF;">      % Compute sun vector</span><br/>               <span style="color: #A0A0A0">  83</span> <span style="color: #A0A0A0; background: #FFFFFF;">      [sunv] = sun_vec(time./(24*3600));   % [3,nn]</span><br/>               <span style="color: #A0A0A0">  84</span> <span style="color: #228B22; background: #FFFFFF;">      </span><br/>               <span style="color: #A0A0A0">  85</span> <span style="color: #228B22; background: #FFFFFF;">      %  Set boresites parallel to Earth-Sun vector if pointing_ref = 2</span><br/>               <span style="color: #A0A0A0">  86</span> <span style="color: #228B22; background: #FFFFFF;">      %  Set boresites anti-parallel to Earth-Sun vector if pointing_ref = -2</span><br/>               <span style="color: #A0A0A0">  87</span> <span style="color: #A0A0A0; background: #FFFFFF;">      bs = sunv.*(pointing_ref(ii)/abs(pointing_ref(ii)));</span><br/>               <span style="color: #A0A0A0">  88</span> <span style="color: #228B22; background: #FFFFFF;">      </span><br/>               <span style="color: #A0A0A0">  89</span> <span style="color: #228B22; background: #FFFFFF;">      %  Boresite is referenced to ECI, if frame = 1, must rotate to ECEF</span><br/>               <span style="color: #A0A0A0">  90</span> <span style="color: #A0A0A0; background: #FFFFFF;">      if frame == 1</span><br/>               <span style="color: #A0A0A0">  91</span> <span style="color: #A0A0A0; background: #FFFFFF;">         phi = sidereal(gps2utc(sec2gpst(time')))';  % [1,nn]</span><br/>               <span style="color: #A0A0A0">  92</span> <span style="color: #A0A0A0; background: #FFFFFF;">         for jj = 1:size(time,2)</span><br/>               <span style="color: #A0A0A0">  93</span> <span style="color: #A0A0A0; background: #FFFFFF;">            R = [cos(phi(jj)) sin(phi(jj)) 0; -sin(phi(jj)) cos(phi(jj)) 0; 0 0 1];</span><br/>               <span style="color: #A0A0A0">  94</span> <span style="color: #A0A0A0; background: #FFFFFF;">            ant_bs(:,jj) = R*bs(:,jj);</span><br/>               <span style="color: #A0A0A0">  95</span> <span style="color: #A0A0A0; background: #FFFFFF;">         end</span><br/>               <span style="color: #A0A0A0">  96</span> <span style="color: #228B22; background: #FFFFFF;">      else</span><br/>               <span style="color: #A0A0A0">  97</span> <span style="color: #A0A0A0; background: #FFFFFF;">         ant_bs = bs;</span><br/>               <span style="color: #A0A0A0">  98</span> <span style="color: #A0A0A0; background: #FFFFFF;">      end</span><br/>               <span style="color: #A0A0A0">  99</span> <span style="color: #A0A0A0; background: #FFFFFF;">   end</span><br/>               <span style="color: #A0A0A0"> 100</span> <span style="color: #228B22; background: #FFFFFF;">   </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 101</span> <span style="color: #000000; background: #FFF0F0;">   if abs(pointing_ref(ii)) == 3   % s/c alligned perpendicular to ecliptic </span><br/>               <span style="color: #A0A0A0"> 102</span> <span style="color: #228B22; background: #FFFFFF;">      %  Create the unit vector normal to the ecliptic plane, written in ECI</span><br/>               <span style="color: #A0A0A0"> 103</span> <span style="color: #A0A0A0; background: #FFFFFF;">      eclipt_norm = [1 0 0; 0 cos(0.409279) sin(0.409279); 0 -sin(0.409279) cos(0.409279)]'*[0;0;1];</span><br/>               <span style="color: #A0A0A0"> 104</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 105</span> <span style="color: #228B22; background: #FFFFFF;">      %  Set boresites parallel to eclipt_norm if pointing_ref = 3</span><br/>               <span style="color: #A0A0A0"> 106</span> <span style="color: #228B22; background: #FFFFFF;">      %  Set boresites anti-parallel to eclipt_norm if pointing_ref = -3</span><br/>               <span style="color: #A0A0A0"> 107</span> <span style="color: #A0A0A0; background: #FFFFFF;">      bs = eclipt_norm*ones(1,size(time,2)).*(pointing_ref(ii)/abs(pointing_ref(ii)));</span><br/>               <span style="color: #A0A0A0"> 108</span> <span style="color: #228B22; background: #FFFFFF;">      </span><br/>               <span style="color: #A0A0A0"> 109</span> <span style="color: #228B22; background: #FFFFFF;">      %  Boresite is referenced to ECI, if frame = 1, must rotate to ECEF</span><br/>               <span style="color: #A0A0A0"> 110</span> <span style="color: #A0A0A0; background: #FFFFFF;">      if frame == 1</span><br/>               <span style="color: #A0A0A0"> 111</span> <span style="color: #A0A0A0; background: #FFFFFF;">         phi = sidereal(gps2utc(sec2gpst(time')))';  % [1,nn]</span><br/>               <span style="color: #A0A0A0"> 112</span> <span style="color: #A0A0A0; background: #FFFFFF;">         for jj = 1:size(time,2)</span><br/>               <span style="color: #A0A0A0"> 113</span> <span style="color: #A0A0A0; background: #FFFFFF;">            R = [cos(phi(jj)) sin(phi(jj)) 0; -sin(phi(jj)) cos(phi(jj)) 0; 0 0 1];</span><br/>               <span style="color: #A0A0A0"> 114</span> <span style="color: #A0A0A0; background: #FFFFFF;">            ant_bs(:,jj) = R*bs(:,jj);</span><br/>               <span style="color: #A0A0A0"> 115</span> <span style="color: #A0A0A0; background: #FFFFFF;">         end</span><br/>               <span style="color: #A0A0A0"> 116</span> <span style="color: #228B22; background: #FFFFFF;">      else</span><br/>               <span style="color: #A0A0A0"> 117</span> <span style="color: #A0A0A0; background: #FFFFFF;">         ant_bs = bs;</span><br/>               <span style="color: #A0A0A0"> 118</span> <span style="color: #A0A0A0; background: #FFFFFF;">      end</span><br/>               <span style="color: #A0A0A0"> 119</span> <span style="color: #A0A0A0; background: #FFFFFF;">   end</span><br/>               <span style="color: #A0A0A0"> 120</span> <span style="color: #228B22; background: #FFFFFF;">   </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 121</span> <span style="color: #000000; background: #FFF0F0;">   if abs(pointing_ref(ii)) == 4   % inertially fixed wrt apogee nadir vector </span><br/>               <span style="color: #A0A0A0"> 122</span> <span style="color: #228B22; background: #FFFFFF;">     </span><br/>               <span style="color: #A0A0A0"> 123</span> <span style="color: #A0A0A0; background: #FFFFFF;">       if frame  % working in ecef frame</span><br/>               <span style="color: #A0A0A0"> 124</span> <span style="color: #228B22; background: #FFFFFF;">           %  r_sat is in ECEF, so compute bs in ECI then rotate to ECEF</span><br/>               <span style="color: #A0A0A0"> 125</span> <span style="color: #228B22; background: #FFFFFF;">           %  Compute r_sat in ECI frame</span><br/>               <span style="color: #A0A0A0"> 126</span> <span style="color: #A0A0A0; background: #FFFFFF;">           r_sat_eci = ecef2eci(sec2gpst(time'),r_sat')';    % [3,nn]</span><br/>               <span style="color: #A0A0A0"> 127</span> <span style="color: #228B22; background: #FFFFFF;">           </span><br/>               <span style="color: #A0A0A0"> 128</span> <span style="color: #228B22; background: #FFFFFF;">           %  Compute magnitude of position vector, the radial distance to host vehicle</span><br/>               <span style="color: #A0A0A0"> 129</span> <span style="color: #A0A0A0; background: #FFFFFF;">           mag_r_sat = sqrt(sum(r_sat_eci.^2));               % [1,nn]</span><br/>               <span style="color: #A0A0A0"> 130</span> <span style="color: #228B22; background: #FFFFFF;">           </span><br/>               <span style="color: #A0A0A0"> 131</span> <span style="color: #228B22; background: #FFFFFF;">           % find the apogee point (highest altitude) of the current data set</span><br/>               <span style="color: #A0A0A0"> 132</span> <span style="color: #A0A0A0; background: #FFFFFF;">           ind = find(mag_r_sat == max(mag_r_sat));</span><br/>               <span style="color: #A0A0A0"> 133</span> <span style="color: #228B22; background: #FFFFFF;">           % If the maximum is either the first or last point, data may not contain apogee point</span><br/>               <span style="color: #A0A0A0"> 134</span> <span style="color: #A0A0A0; background: #FFFFFF;">           if (ind == 1) || (ind == length(time))</span><br/>               <span style="color: #A0A0A0"> 135</span> <span style="color: #A0A0A0; background: #FFFFFF;">               warning('Warning:OrbitLength','Apogee at end point, make sure ephemeris covers &gt;= one full orbit!')</span><br/>               <span style="color: #A0A0A0"> 136</span> <span style="color: #A0A0A0; background: #FFFFFF;">           end</span><br/>               <span style="color: #A0A0A0"> 137</span> <span style="color: #228B22; background: #FFFFFF;">           </span><br/>               <span style="color: #A0A0A0"> 138</span> <span style="color: #228B22; background: #FFFFFF;">           %  Compute unit vector corresponding to r_sat at apogee point</span><br/>               <span style="color: #A0A0A0"> 139</span> <span style="color: #A0A0A0; background: #FFFFFF;">           unit_r_sat = r_sat_eci(:,ind)./mag_r_sat(ind);  % [3,1]</span><br/>               <span style="color: #A0A0A0"> 140</span> <span style="color: #228B22; background: #FFFFFF;">           </span><br/>               <span style="color: #A0A0A0"> 141</span> <span style="color: #228B22; background: #FFFFFF;">           %  Set boresites parallel to r_sat direction if pointing_ref = 1</span><br/>               <span style="color: #A0A0A0"> 142</span> <span style="color: #228B22; background: #FFFFFF;">           %  Set boresites anti-parallel to r_sat direction if pointing_ref = -1</span><br/>               <span style="color: #A0A0A0"> 143</span> <span style="color: #A0A0A0; background: #FFFFFF;">           bs_eci = ( unit_r_sat*ones(1,length(time)) ) .* (pointing_ref(ii)/abs(pointing_ref(ii)));</span><br/>               <span style="color: #A0A0A0"> 144</span> <span style="color: #228B22; background: #FFFFFF;">           </span><br/>               <span style="color: #A0A0A0"> 145</span> <span style="color: #228B22; background: #FFFFFF;">           % convert boresite unit vectors back to ECEF</span><br/>               <span style="color: #A0A0A0"> 146</span> <span style="color: #A0A0A0; background: #FFFFFF;">           ant_bs = eci2ecef(sec2gpst(time'),bs_eci')';    % [3,nn]</span><br/>               <span style="color: #A0A0A0"> 147</span> <span style="color: #228B22; background: #FFFFFF;">           </span><br/>               <span style="color: #A0A0A0"> 148</span> <span style="color: #228B22; background: #FFFFFF;">       else % working in eci frame</span><br/>               <span style="color: #A0A0A0"> 149</span> <span style="color: #228B22; background: #FFFFFF;">           %  r_sat is in ECI, so boresite will be returned as ECI</span><br/>               <span style="color: #A0A0A0"> 150</span> <span style="color: #228B22; background: #FFFFFF;">           %  Compute magnitude of position vector, the radial distance to host vehicle</span><br/>               <span style="color: #A0A0A0"> 151</span> <span style="color: #A0A0A0; background: #FFFFFF;">           mag_r_sat = sqrt(sum(r_sat.^2));                      % [1,nn]</span><br/>               <span style="color: #A0A0A0"> 152</span> <span style="color: #228B22; background: #FFFFFF;">           </span><br/>               <span style="color: #A0A0A0"> 153</span> <span style="color: #228B22; background: #FFFFFF;">           % find the apogee point (highest altitude) of the current data set</span><br/>               <span style="color: #A0A0A0"> 154</span> <span style="color: #A0A0A0; background: #FFFFFF;">           ind = find(mag_r_sat == max(mag_r_sat));</span><br/>               <span style="color: #A0A0A0"> 155</span> <span style="color: #228B22; background: #FFFFFF;">           % If the maximum is either the first or last point, data may not contain apogee point</span><br/>               <span style="color: #A0A0A0"> 156</span> <span style="color: #A0A0A0; background: #FFFFFF;">           if (ind == 1) || (ind == length(time))</span><br/>               <span style="color: #A0A0A0"> 157</span> <span style="color: #A0A0A0; background: #FFFFFF;">               warning('Warning:OrbitLength','Apogee at end point, make sure ephemeris covers &gt;= one full orbit!')</span><br/>               <span style="color: #A0A0A0"> 158</span> <span style="color: #A0A0A0; background: #FFFFFF;">           end</span><br/>               <span style="color: #A0A0A0"> 159</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 160</span> <span style="color: #228B22; background: #FFFFFF;">           %  Compute unit vector corresponding to r_sat at apogee point</span><br/>               <span style="color: #A0A0A0"> 161</span> <span style="color: #A0A0A0; background: #FFFFFF;">           unit_r_sat = r_sat(:,ind)./mag_r_sat(ind);  % [3,1]</span><br/>               <span style="color: #A0A0A0"> 162</span> <span style="color: #228B22; background: #FFFFFF;">           </span><br/>               <span style="color: #A0A0A0"> 163</span> <span style="color: #228B22; background: #FFFFFF;">           %  Set boresites parallel to r_sat direction if pointing_ref = 1</span><br/>               <span style="color: #A0A0A0"> 164</span> <span style="color: #228B22; background: #FFFFFF;">           %  Set boresites anti-parallel to r_sat direction if pointing_ref = -1</span><br/>               <span style="color: #A0A0A0"> 165</span> <span style="color: #A0A0A0; background: #FFFFFF;">           ant_bs = ( unit_r_sat*ones(1,length(time)) ) .* (pointing_ref(ii)/abs(pointing_ref(ii)));</span><br/>               <span style="color: #A0A0A0"> 166</span> <span style="color: #A0A0A0; background: #FFFFFF;">       end</span><br/>               <span style="color: #A0A0A0"> 167</span> <span style="color: #A0A0A0; background: #FFFFFF;">   end</span><br/>               <span style="color: #A0A0A0"> 168</span> <span style="color: #228B22; background: #FFFFFF;">   </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 169</span> <span style="color: #000000; background: #FFF0F0;">   if abs(pointing_ref(ii)) == 5   % antennas in fore and aft directions wrt nadir pointing body frame </span><br/>               <span style="color: #A0A0A0"> 170</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 171</span> <span style="color: #A0A0A0; background: #FFFFFF;">       if frame  % vectors given/required in ecef, position and velocity already in ecef</span><br/>               <span style="color: #A0A0A0"> 172</span> <span style="color: #A0A0A0; background: #FFFFFF;">           r = r_sat; v = v_sat;</span><br/>               <span style="color: #A0A0A0"> 173</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 174</span> <span style="color: #228B22; background: #FFFFFF;">           %  Compute magnitude of position vector, the radial distance to host vehicle</span><br/>               <span style="color: #A0A0A0"> 175</span> <span style="color: #A0A0A0; background: #FFFFFF;">           mag_r_sat = sqrt(sum(r.^2));             % [1,nn]</span><br/>               <span style="color: #A0A0A0"> 176</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 177</span> <span style="color: #228B22; background: #FFFFFF;">           %  Compute unit vector corresponding to r_sat at apogee point</span><br/>               <span style="color: #A0A0A0"> 178</span> <span style="color: #A0A0A0; background: #FFFFFF;">           unit_r_sat = r./([1;1;1]*mag_r_sat);     % [3,nn]</span><br/>               <span style="color: #A0A0A0"> 179</span> <span style="color: #228B22; background: #FFFFFF;">           </span><br/>               <span style="color: #A0A0A0"> 180</span> <span style="color: #228B22; background: #FFFFFF;">           %  Compute magnitude of position vector, the radial distance to host vehicle</span><br/>               <span style="color: #A0A0A0"> 181</span> <span style="color: #A0A0A0; background: #FFFFFF;">           mag_v_sat = sqrt(sum(v.^2));             % [1,nn]</span><br/>               <span style="color: #A0A0A0"> 182</span> <span style="color: #228B22; background: #FFFFFF;">           </span><br/>               <span style="color: #A0A0A0"> 183</span> <span style="color: #228B22; background: #FFFFFF;">           %  Compute unit vector corresponding to v_sat at apogee point</span><br/>               <span style="color: #A0A0A0"> 184</span> <span style="color: #A0A0A0; background: #FFFFFF;">           unit_v_sat = v./([1;1;1]*mag_v_sat);     % [3,nn]</span><br/>               <span style="color: #A0A0A0"> 185</span> <span style="color: #228B22; background: #FFFFFF;">       </span><br/>               <span style="color: #A0A0A0"> 186</span> <span style="color: #A0A0A0; background: #FFFFFF;">           ant_bs = -sign(pointing_ref(ii)) * cross(unit_r_sat,cross(unit_r_sat,unit_v_sat));</span><br/>               <span style="color: #A0A0A0"> 187</span> <span style="color: #228B22; background: #FFFFFF;">       </span><br/>               <span style="color: #A0A0A0"> 188</span> <span style="color: #228B22; background: #FFFFFF;">       else  % vectors given/required in eci, must first convert to ecef</span><br/>               <span style="color: #A0A0A0"> 189</span> <span style="color: #228B22; background: #FFFFFF;">           %  Compute r_sat in ECEF frame</span><br/>               <span style="color: #A0A0A0"> 190</span> <span style="color: #A0A0A0; background: #FFFFFF;">           [r,v] = ecef2eci(sec2gpst(time'),r_sat',v_sat');    % [3,nn]</span><br/>               <span style="color: #A0A0A0"> 191</span> <span style="color: #A0A0A0; background: #FFFFFF;">           r = r'; v = v';</span><br/>               <span style="color: #A0A0A0"> 192</span> <span style="color: #228B22; background: #FFFFFF;">           </span><br/>               <span style="color: #A0A0A0"> 193</span> <span style="color: #228B22; background: #FFFFFF;">           %  Compute magnitude of position vector, the radial distance to host vehicle</span><br/>               <span style="color: #A0A0A0"> 194</span> <span style="color: #A0A0A0; background: #FFFFFF;">           mag_r_sat = sqrt(sum(r.^2));             % [1,nn]</span><br/>               <span style="color: #A0A0A0"> 195</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 196</span> <span style="color: #228B22; background: #FFFFFF;">           %  Compute unit vector corresponding to r_sat at apogee point</span><br/>               <span style="color: #A0A0A0"> 197</span> <span style="color: #A0A0A0; background: #FFFFFF;">           unit_r_sat = r./([1;1;1]*mag_r_sat);     % [3,nn]</span><br/>               <span style="color: #A0A0A0"> 198</span> <span style="color: #228B22; background: #FFFFFF;">           </span><br/>               <span style="color: #A0A0A0"> 199</span> <span style="color: #228B22; background: #FFFFFF;">           %  Compute magnitude of position vector, the radial distance to host vehicle</span><br/>               <span style="color: #A0A0A0"> 200</span> <span style="color: #A0A0A0; background: #FFFFFF;">           mag_v_sat = sqrt(sum(v.^2));             % [1,nn]</span><br/>               <span style="color: #A0A0A0"> 201</span> <span style="color: #228B22; background: #FFFFFF;">           </span><br/>               <span style="color: #A0A0A0"> 202</span> <span style="color: #228B22; background: #FFFFFF;">           %  Compute unit vector corresponding to v_sat at apogee point</span><br/>               <span style="color: #A0A0A0"> 203</span> <span style="color: #A0A0A0; background: #FFFFFF;">           unit_v_sat = v./([1;1;1]*mag_v_sat);     % [3,nn]</span><br/>               <span style="color: #A0A0A0"> 204</span> <span style="color: #228B22; background: #FFFFFF;">       </span><br/>               <span style="color: #A0A0A0"> 205</span> <span style="color: #A0A0A0; background: #FFFFFF;">           bs_eci = -sign(pointing_ref(ii)) * cross(unit_r_sat,cross(unit_r_sat,unit_v_sat));</span><br/>               <span style="color: #A0A0A0"> 206</span> <span style="color: #228B22; background: #FFFFFF;">       </span><br/>               <span style="color: #A0A0A0"> 207</span> <span style="color: #228B22; background: #FFFFFF;">           % convert boresite unit vectors back to ECEF</span><br/>               <span style="color: #A0A0A0"> 208</span> <span style="color: #A0A0A0; background: #FFFFFF;">           ant_bs = eci2ecef(sec2gpst(time'),bs_eci')';    % [3,nn]</span><br/>               <span style="color: #A0A0A0"> 209</span> <span style="color: #A0A0A0; background: #FFFFFF;">       end  % else frame</span><br/>               <span style="color: #A0A0A0"> 210</span> <span style="color: #A0A0A0; background: #FFFFFF;">       clear r v</span><br/>               <span style="color: #A0A0A0"> 211</span> <span style="color: #A0A0A0; background: #FFFFFF;">   end  % if '5'</span><br/>               <span style="color: #A0A0A0"> 212</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 213</span> <span style="color: #000000; background: #FFE2E2;">   if abs(pointing_ref(ii)) == 6   % antennas in port and starboard directions wrt nadir pointing body frame </span><br/>               <span style="color: #A0A0A0"> 214</span> <span style="color: #228B22; background: #FFFFFF;">     </span><br/>               <span style="color: #A0A0A0"> 215</span> <span style="color: #A0A0A0; background: #FFFFFF;">       if frame  % vectors given/required in ecef, position and velocity already in ecef</span><br/>               <span style="color: #A0A0A0"> 216</span> <span style="color: #A0A0A0; background: #FFFFFF;">           r = r_sat; v = v_sat;</span><br/>               <span style="color: #A0A0A0"> 217</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 218</span> <span style="color: #228B22; background: #FFFFFF;">           %  Compute magnitude of position vector, the radial distance to host vehicle</span><br/>               <span style="color: #A0A0A0"> 219</span> <span style="color: #A0A0A0; background: #FFFFFF;">           mag_r_sat = sqrt(sum(r.^2));             % [1,nn]</span><br/>               <span style="color: #A0A0A0"> 220</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 221</span> <span style="color: #228B22; background: #FFFFFF;">           %  Compute unit vector corresponding to r_sat at apogee point</span><br/>               <span style="color: #A0A0A0"> 222</span> <span style="color: #A0A0A0; background: #FFFFFF;">           unit_r_sat = r./([1;1;1]*mag_r_sat);     % [3,nn]</span><br/>               <span style="color: #A0A0A0"> 223</span> <span style="color: #228B22; background: #FFFFFF;">           </span><br/>               <span style="color: #A0A0A0"> 224</span> <span style="color: #228B22; background: #FFFFFF;">           %  Compute magnitude of position vector, the radial distance to host vehicle</span><br/>               <span style="color: #A0A0A0"> 225</span> <span style="color: #A0A0A0; background: #FFFFFF;">           mag_v_sat = sqrt(sum(v.^2));             % [1,nn]</span><br/>               <span style="color: #A0A0A0"> 226</span> <span style="color: #228B22; background: #FFFFFF;">           </span><br/>               <span style="color: #A0A0A0"> 227</span> <span style="color: #228B22; background: #FFFFFF;">           %  Compute unit vector corresponding to v_sat at apogee point</span><br/>               <span style="color: #A0A0A0"> 228</span> <span style="color: #A0A0A0; background: #FFFFFF;">           unit_v_sat = v./([1;1;1]*mag_v_sat);     % [3,nn]</span><br/>               <span style="color: #A0A0A0"> 229</span> <span style="color: #228B22; background: #FFFFFF;">       </span><br/>               <span style="color: #A0A0A0"> 230</span> <span style="color: #A0A0A0; background: #FFFFFF;">           ant_bs = sign(pointing_ref(ii)) * cross(unit_r_sat,unit_v_sat);</span><br/>               <span style="color: #A0A0A0"> 231</span> <span style="color: #228B22; background: #FFFFFF;">       </span><br/>               <span style="color: #A0A0A0"> 232</span> <span style="color: #228B22; background: #FFFFFF;">       else  % vectors given/required in eci, must first convert to ecef</span><br/>               <span style="color: #A0A0A0"> 233</span> <span style="color: #228B22; background: #FFFFFF;">           %  Compute r_sat in ECEF frame</span><br/>               <span style="color: #A0A0A0"> 234</span> <span style="color: #A0A0A0; background: #FFFFFF;">           [r,v] = ecef2eci(sec2gpst(time'),r_sat',v_sat');    % [3,nn]</span><br/>               <span style="color: #A0A0A0"> 235</span> <span style="color: #A0A0A0; background: #FFFFFF;">           r = r'; v = v';</span><br/>               <span style="color: #A0A0A0"> 236</span> <span style="color: #228B22; background: #FFFFFF;">           </span><br/>               <span style="color: #A0A0A0"> 237</span> <span style="color: #228B22; background: #FFFFFF;">           %  Compute magnitude of position vector, the radial distance to host vehicle</span><br/>               <span style="color: #A0A0A0"> 238</span> <span style="color: #A0A0A0; background: #FFFFFF;">           mag_r_sat = sqrt(sum(r.^2));             % [1,nn]</span><br/>               <span style="color: #A0A0A0"> 239</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 240</span> <span style="color: #228B22; background: #FFFFFF;">           %  Compute unit vector corresponding to r_sat at apogee point</span><br/>               <span style="color: #A0A0A0"> 241</span> <span style="color: #A0A0A0; background: #FFFFFF;">           unit_r_sat = r./([1;1;1]*mag_r_sat);     % [3,nn]</span><br/>               <span style="color: #A0A0A0"> 242</span> <span style="color: #228B22; background: #FFFFFF;">           </span><br/>               <span style="color: #A0A0A0"> 243</span> <span style="color: #228B22; background: #FFFFFF;">           %  Compute magnitude of position vector, the radial distance to host vehicle</span><br/>               <span style="color: #A0A0A0"> 244</span> <span style="color: #A0A0A0; background: #FFFFFF;">           mag_v_sat = sqrt(sum(v.^2));             % [1,nn]</span><br/>               <span style="color: #A0A0A0"> 245</span> <span style="color: #228B22; background: #FFFFFF;">           </span><br/>               <span style="color: #A0A0A0"> 246</span> <span style="color: #228B22; background: #FFFFFF;">           %  Compute unit vector corresponding to v_sat at apogee point</span><br/>               <span style="color: #A0A0A0"> 247</span> <span style="color: #A0A0A0; background: #FFFFFF;">           unit_v_sat = v./([1;1;1]*mag_v_sat);     % [3,nn]</span><br/>               <span style="color: #A0A0A0"> 248</span> <span style="color: #228B22; background: #FFFFFF;">       </span><br/>               <span style="color: #A0A0A0"> 249</span> <span style="color: #A0A0A0; background: #FFFFFF;">           bs_eci = sign(pointing_ref(ii)) * cross(unit_r_sat,unit_v_sat);</span><br/>               <span style="color: #A0A0A0"> 250</span> <span style="color: #228B22; background: #FFFFFF;">       </span><br/>               <span style="color: #A0A0A0"> 251</span> <span style="color: #228B22; background: #FFFFFF;">           % convert boresite unit vectors back to ECEF</span><br/>               <span style="color: #A0A0A0"> 252</span> <span style="color: #A0A0A0; background: #FFFFFF;">           ant_bs = eci2ecef(sec2gpst(time'),bs_eci')';    % [3,nn]</span><br/>               <span style="color: #A0A0A0"> 253</span> <span style="color: #A0A0A0; background: #FFFFFF;">       end  % else frame</span><br/>               <span style="color: #A0A0A0"> 254</span> <span style="color: #A0A0A0; background: #FFFFFF;">   end  % if '6'</span><br/>               <span style="color: #A0A0A0"> 255</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 256</span> <span style="color: #228B22; background: #FFFFFF;">   %  Save boresites in one composite boresite matrix [3*num_ant,nn]</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 257</span> <a name="Line257"></a><span style="color: #000000; background: #FFD4D4;">   boresite(:,:,ii)=ant_bs; </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1442 </span><span style="color: #000000; font-weight: bold"> 258</span> <span style="color: #000000; background: #FFF0F0;">end </span><br/></pre></body></html>