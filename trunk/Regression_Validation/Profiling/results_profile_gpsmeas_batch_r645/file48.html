<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><link rel="stylesheet" href="file:///C:\Program Files\MATLAB\R2008a\toolbox\matlab\codetools\matlab-report-styles.css" type="text/css" /><title>Function details for alm2xyz</title><link rel="stylesheet" href="file:///C:\Program Files\MATLAB\R2008a\toolbox\matlab\codetools\matlab-report-styles.css" type="text/css" /></head><body bgcolor="#F8F8F8"><strong>This is a static copy of a profile report</strong><p><a href="file0.html">Home</a><p><span style="font-size:14pt; background:#FFE4B0">alm2xyz (1 call, 0.013 sec)</span><br/><i>Generated 29-May-2009 12:16:08 using cpu time.</i><br/>M-function in file C:\Users\abrown\Projects\ODTBX\matlab\trunk\ODTBX_Source\alm2xyz.m<br/>[Copy to new window for comparing multiple runs]<div class="grayline"/><div class="grayline"/><strong>Parents</strong> (calling functions)<br/><p><table border=0 cellspacing=0 cellpadding=6><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Function Name</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Function Type</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Calls</td></tr><tr><td class="td-linebottomrt"><a href="file20.html">gpsmeas</a></td><td class="td-linebottomrt">M-function</td><td class="td-linebottomrt">1</td></tr></table><div class="grayline"/><strong>Lines where the most time was spent</strong><br/> <p><table border=0 cellspacing=0 cellpadding=6><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Line Number</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Code</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Calls</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Total Time</td><td class="td-linebottomrt" bgcolor="#F0F0F0">% Time</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Time Plot</td></tr><tr><td class="td-linebottomrt"><a href="#Line167">167</a></td><td class="td-linebottomrt"><pre>end % (time_step)</pre></td><td class="td-linebottomrt">4</td><td class="td-linebottomrt">0.003 s</td><td class="td-linebottomrt" class="td-linebottomrt">27.5%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2008a\toolbox\matlab\codetools\private\one-pixel.gif" width=27 height=10></td></tr><tr><td class="td-linebottomrt"><a href="#Line146">146</a></td><td class="td-linebottomrt"><pre>o_cross_r = cross([0 0 EARTH_R...</pre></td><td class="td-linebottomrt">4</td><td class="td-linebottomrt">0.003 s</td><td class="td-linebottomrt" class="td-linebottomrt">27.4%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2008a\toolbox\matlab\codetools\private\one-pixel.gif" width=27 height=10></td></tr><tr><td class="td-linebottomrt"><a href="#Line98">98</a></td><td class="td-linebottomrt"><pre>M_k = rem(M_k,2*pi);          ...</pre></td><td class="td-linebottomrt">4</td><td class="td-linebottomrt">0.003 s</td><td class="td-linebottomrt" class="td-linebottomrt">27.0%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2008a\toolbox\matlab\codetools\private\one-pixel.gif" width=27 height=10></td></tr><tr><td class="td-linebottomrt"><a href="#Line108">108</a></td><td class="td-linebottomrt"><pre>E = M_k + (ecc.*sin(E_old));</pre></td><td class="td-linebottomrt">24</td><td class="td-linebottomrt">0.000 s</td><td class="td-linebottomrt" class="td-linebottomrt">0.6%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2008a\toolbox\matlab\codetools\private\one-pixel.gif" width=1 height=10></td></tr><tr><td class="td-linebottomrt"><a href="#Line109">109</a></td><td class="td-linebottomrt"><pre>end</pre></td><td class="td-linebottomrt">24</td><td class="td-linebottomrt">0.000 s</td><td class="td-linebottomrt" class="td-linebottomrt">0.6%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2008a\toolbox\matlab\codetools\private\one-pixel.gif" width=1 height=10></td></tr><tr><td class="td-linebottomrt">All other lines</td><td class="td-linebottomrt">&nbsp;</td><td class="td-linebottomrt">&nbsp;</td><td class="td-linebottomrt">0.002 s</td><td class="td-linebottomrt">16.8%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2008a\toolbox\matlab\codetools\private\one-pixel.gif" width=17 height=10></td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Totals</td><td class="td-linebottomrt" bgcolor="#F0F0F0">&nbsp;</td><td class="td-linebottomrt" bgcolor="#F0F0F0">&nbsp;</td><td class="td-linebottomrt" bgcolor="#F0F0F0">0.013 s</td><td class="td-linebottomrt" bgcolor="#F0F0F0">100%</td><td class="td-linebottomrt" bgcolor="#F0F0F0">&nbsp;</td></tr></table><div class="grayline"/><b>Children</b> (called functions)<br/><p><table border=0 cellspacing=0 cellpadding=6><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Function Name</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Function Type</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Calls</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Total Time</td><td class="td-linebottomrt" bgcolor="#F0F0F0">% Time</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Time Plot</td></tr><tr><td class="td-linebottomrt"><a href="file46.html">cross</a></td><td class="td-linebottomrt">M-function</td><td class="td-linebottomrt">4</td><td class="td-linebottomrt">0.003 s</td><td class="td-linebottomrt">25.0%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2008a\toolbox\matlab\codetools\private\one-pixel.gif" width=25 height=10></td></tr><tr><td class="td-linebottomrt">Self time (built-ins, overhead, etc.)</td><td class="td-linebottomrt">&nbsp;</td><td class="td-linebottomrt">&nbsp;</td><td class="td-linebottomrt">0.009 s</td><td class="td-linebottomrt">75.0%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2008a\toolbox\matlab\codetools\private\one-pixel.gif" width=75 height=10></td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Totals</td><td class="td-linebottomrt" bgcolor="#F0F0F0">&nbsp;</td><td class="td-linebottomrt" bgcolor="#F0F0F0">&nbsp;</td><td class="td-linebottomrt" bgcolor="#F0F0F0">0.013 s</td><td class="td-linebottomrt" bgcolor="#F0F0F0">100%</td><td class="td-linebottomrt" bgcolor="#F0F0F0">&nbsp;</td></tr></table><div class="grayline"/><strong>M-Lint results</strong><br/>No M-Lint messages.<div class="grayline"/><strong>Coverage results</strong><br/>[ Show coverage for parent directory ]<br/><table border=0 cellspacing=0 cellpadding=6><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Total lines in function</td><td class="td-linebottomrt">167</td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Non-code lines (comments, blank lines)</td><td class="td-linebottomrt">113</td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Code lines (lines that can run)</td><td class="td-linebottomrt">54</td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Code lines that did run</td><td class="td-linebottomrt">49</td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Code lines that did not run</td><td class="td-linebottomrt">5</td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Coverage (did run/can run)</td><td class="td-linebottomrt">90.74 %</td></tr></table><div class="grayline"/><b>Function listing</b><br/><pre> <span style="color: #FF0000; font-weight: bold; text-decoration: none">  time</span> <span style="color: #0000FF; font-weight: bold; text-decoration: none">  calls</span>  <span style="font-weight: bold; text-decoration: none">line</span><br/>               <span style="color: #A0A0A0">   1</span> <span style="color: #A0A0A0; background: #FFFFFF;">function [pos,vel] = alm2xyz(time,alm,frame)</span><br/>               <span style="color: #A0A0A0">   2</span> <span style="color: #228B22; background: #FFFFFF;">% ALM2XYZ  Compute R and V from GPS alamanc data</span><br/>               <span style="color: #A0A0A0">   3</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">   4</span> <span style="color: #228B22; background: #FFFFFF;">%    [pos,vel] = alm2xyz(time,alm,frame) </span><br/>               <span style="color: #A0A0A0">   5</span> <span style="color: #228B22; background: #FFFFFF;">%    Function computes position and velocity of satellite(s) from </span><br/>               <span style="color: #A0A0A0">   6</span> <span style="color: #228B22; background: #FFFFFF;">%    GPS almanac data, corresponding to input time vector.</span><br/>               <span style="color: #A0A0A0">   7</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">   8</span> <span style="color: #228B22; background: #FFFFFF;">%    INPUTS:</span><br/>               <span style="color: #A0A0A0">   9</span> <span style="color: #228B22; background: #FFFFFF;">%       time(1,n)    vector, in linear GPS seconds, since start of </span><br/>               <span style="color: #A0A0A0">  10</span> <span style="color: #228B22; background: #FFFFFF;">%                    GPS time</span><br/>               <span style="color: #A0A0A0">  11</span> <span style="color: #228B22; background: #FFFFFF;">%       alm(mm,13)   matrix, almanac data in modified format</span><br/>               <span style="color: #A0A0A0">  12</span> <span style="color: #228B22; background: #FFFFFF;">%			               mm = #PRNs, 13 variables each PRN</span><br/>               <span style="color: #A0A0A0">  13</span> <span style="color: #228B22; background: #FFFFFF;">%       frame		   scaler, output coord frame</span><br/>               <span style="color: #A0A0A0">  14</span> <span style="color: #228B22; background: #FFFFFF;">%	                     0-ECI, 1-ECEF</span><br/>               <span style="color: #A0A0A0">  15</span> <span style="color: #228B22; background: #FFFFFF;">%    OUTPUTS:</span><br/>               <span style="color: #A0A0A0">  16</span> <span style="color: #228B22; background: #FFFFFF;">%       Size of output matrixes will be [3,n,mm]</span><br/>               <span style="color: #A0A0A0">  17</span> <span style="color: #228B22; background: #FFFFFF;">%         If mm=1, size of outputs will be [3,n]</span><br/>               <span style="color: #A0A0A0">  18</span> <span style="color: #228B22; background: #FFFFFF;">%       pos	  x,y,z position of each SVN at each 'n' time step</span><br/>               <span style="color: #A0A0A0">  19</span> <span style="color: #228B22; background: #FFFFFF;">%       vel	  x,y,z velocity of each SVN at each 'n' time step</span><br/>               <span style="color: #A0A0A0">  20</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">  21</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0">  22</span> <span style="color: #228B22; background: #FFFFFF;">%  REVISION HISTORY</span><br/>               <span style="color: #A0A0A0">  23</span> <span style="color: #228B22; background: #FFFFFF;">%   Author      		Date         	Comment</span><br/>               <span style="color: #A0A0A0">  24</span> <span style="color: #228B22; background: #FFFFFF;">%   Mike Moreau         1997               Original</span><br/>               <span style="color: #A0A0A0">  25</span> <span style="color: #228B22; background: #FFFFFF;">%   Mike Moreau         01/02/2002         Updated</span><br/>               <span style="color: #A0A0A0">  26</span> <span style="color: #228B22; background: #FFFFFF;">%   Mike Moreau         6/2004             Changed GPS vectors to 3D arrays</span><br/>               <span style="color: #A0A0A0">  27</span> <span style="color: #228B22; background: #FFFFFF;">%   Kevin Berry         09/21/2007         Modified for ODTBX</span><br/>               <span style="color: #A0A0A0">  28</span> <span style="color: #228B22; background: #FFFFFF;">%   Keith Speckman      03/15/2008         Minor comment change</span><br/>               <span style="color: #A0A0A0">  29</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0">  30</span> <span style="color: #228B22; background: #FFFFFF;">%*********************************************************</span><br/>               <span style="color: #A0A0A0">  31</span> <span style="color: #228B22; background: #FFFFFF;">% Almanac file has the following format:</span><br/>               <span style="color: #A0A0A0">  32</span> <span style="color: #228B22; background: #FFFFFF;">% Each row corresponds to one SVN</span><br/>               <span style="color: #A0A0A0">  33</span> <span style="color: #228B22; background: #FFFFFF;">% Each SVN has 13 pieces of data associated with it:</span><br/>               <span style="color: #A0A0A0">  34</span> <span style="color: #228B22; background: #FFFFFF;">% column   Description                       variable name</span><br/>               <span style="color: #A0A0A0">  35</span> <span style="color: #228B22; background: #FFFFFF;">% 1        ID                                SVN</span><br/>               <span style="color: #A0A0A0">  36</span> <span style="color: #228B22; background: #FFFFFF;">% 2        SV health                         health</span><br/>               <span style="color: #A0A0A0">  37</span> <span style="color: #228B22; background: #FFFFFF;">% 3        eccentricity                      ecc</span><br/>               <span style="color: #A0A0A0">  38</span> <span style="color: #228B22; background: #FFFFFF;">% 4        time of applicability [s]         toe</span><br/>               <span style="color: #A0A0A0">  39</span> <span style="color: #228B22; background: #FFFFFF;">% 5        orbital inclination (rad)         inc     </span><br/>               <span style="color: #A0A0A0">  40</span> <span style="color: #228B22; background: #FFFFFF;">% 6        rate of right ascension (rad/s)   OMEGA_dot</span><br/>               <span style="color: #A0A0A0">  41</span> <span style="color: #228B22; background: #FFFFFF;">% 7        SQRT(a) (m^1/2)                   root_a</span><br/>               <span style="color: #A0A0A0">  42</span> <span style="color: #228B22; background: #FFFFFF;">% 8        right ascension at toe (rads)     OMEGA_not</span><br/>               <span style="color: #A0A0A0">  43</span> <span style="color: #228B22; background: #FFFFFF;">% 9        argument of perigee (rad)         arg_peri</span><br/>               <span style="color: #A0A0A0">  44</span> <span style="color: #228B22; background: #FFFFFF;">% 10       mean anomaly (rad)                M_not</span><br/>               <span style="color: #A0A0A0">  45</span> <span style="color: #228B22; background: #FFFFFF;">% 11       Af0 (s)                           clock bias</span><br/>               <span style="color: #A0A0A0">  46</span> <span style="color: #228B22; background: #FFFFFF;">% 12       Af1 (s/s)                         clock drift</span><br/>               <span style="color: #A0A0A0">  47</span> <span style="color: #228B22; background: #FFFFFF;">% 13       GPS week                          week</span><br/>               <span style="color: #A0A0A0">  48</span> <span style="color: #228B22; background: #FFFFFF;">%********************************************************</span><br/>               <span style="color: #A0A0A0">  49</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0">  50</span> <span style="color: #228B22; background: #FFFFFF;">%% These values need to obtained and called in multiple subfunctions somehow</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold">  51</span> <span style="color: #000000; background: #FFFFFF;">MU = 3.986005e5;              % Earth's grav. parameter [km^3/s^2] from GPS ICD 1991 </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold">  52</span> <span style="color: #000000; background: #FFFFFF;">EARTH_RATE = 7.2921151467e-5;  % WGS-84 Earth's rotation rate [rad/s] from GPS ICD 1991 </span><br/>               <span style="color: #A0A0A0">  53</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0">  54</span> <span style="color: #228B22; background: #FFFFFF;">%%</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold">  55</span> <span style="color: #000000; background: #FFFFFF;">mm = size(alm,1);                   % number of PRNs </span><br/>               <span style="color: #A0A0A0">  56</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0">  57</span> <span style="color: #228B22; background: #FFFFFF;">% t_epoch is equal to zero at the start of the week</span><br/>               <span style="color: #A0A0A0">  58</span> <span style="color: #228B22; background: #FFFFFF;">% Can be used to directly compute the delta time between the current</span><br/>               <span style="color: #A0A0A0">  59</span> <span style="color: #228B22; background: #FFFFFF;">% time step and the almanac epoch, even across week boundaries</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold">  60</span> <span style="color: #000000; background: #FFFFFF;">t_epoch = time-alm(1,13)*7*86400; </span><br/>               <span style="color: #A0A0A0">  61</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0">  62</span> <span style="color: #228B22; background: #FFFFFF;">% Correct OMEGA provided in almanac for ECI                                    </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold">  63</span> <span style="color: #000000; background: #FFFFFF;">if frame == 0   % ECI </span><br/>               <span style="color: #A0A0A0">  64</span> <span style="color: #A0A0A0; background: #FFFFFF;">    disp('ECI to ECEF conversion isn''t implimented yet')</span><br/>               <span style="color: #A0A0A0">  65</span> <span style="color: #228B22; background: #FFFFFF;">%    alm(:,8) = mod(alm(:,8) + sidereal(gps2utc([alm(:,13),zeros(size(alm(:,13)))])),2*pi)</span><br/>               <span style="color: #A0A0A0">  66</span> <span style="color: #228B22; background: #FFFFFF;">   % should be able to replace sidereal part with:</span><br/>               <span style="color: #A0A0A0">  67</span> <span style="color: #228B22; background: #FFFFFF;">%    testt=datenum(gps2utc([alm(1,13),zeros(size(alm(1,13)))]));</span><br/>               <span style="color: #A0A0A0">  68</span> <span style="color: #228B22; background: #FFFFFF;">%    jatEarthRef.GAST(matlabTime2MJD(testt),convertTime('TT', 'UTC', testt))</span><br/>               <span style="color: #A0A0A0">  69</span> <span style="color: #228B22; background: #FFFFFF;">   % or:</span><br/>               <span style="color: #A0A0A0">  70</span> <span style="color: #228B22; background: #FFFFFF;">%    jatEarthRef.GMST(matlabTime2MJD(testt))</span><br/>               <span style="color: #A0A0A0">  71</span> <span style="color: #228B22; background: #FFFFFF;">   % the problem is that the input is UT1 but I only have UTC</span><br/>               <span style="color: #A0A0A0">  72</span> <span style="color: #A0A0A0; background: #FFFFFF;">end</span><br/>               <span style="color: #A0A0A0">  73</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0">  74</span> <span style="color: #228B22; background: #FFFFFF;">% Read almanac parameters (orbital elements) from almanac</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold">  75</span> <span style="color: #000000; background: #FFFFFF;">root_a = alm(:,7); </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold">  76</span> <span style="color: #000000; background: #FFFFFF;">a = (root_a).^2;              % semimajor axis (kilometers) </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold">  77</span> <span style="color: #000000; background: #FFFFFF;">toe = alm(:,4);               % time of reference ephemeris </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold">  78</span> <span style="color: #000000; background: #FFFFFF;">M_not = alm(:,10);            % mean anomaly at toe </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold">  79</span> <span style="color: #000000; background: #FFFFFF;">ecc = alm(:,3);               % eccentricity </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold">  80</span> <span style="color: #000000; background: #FFFFFF;">arg_peri = alm(:,9);          % argument of periapsis </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold">  81</span> <span style="color: #000000; background: #FFFFFF;">inc = alm(:,5);               % inclination </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold">  82</span> <span style="color: #000000; background: #FFFFFF;">OMEGA_not = alm(:,8);         % long of asc node at epoch </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold">  83</span> <span style="color: #000000; background: #FFFFFF;">OMEGA_dot = alm(:,6);         % rate of long of asc node </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold">  84</span> <span style="color: #000000; background: #FFFFFF;">n_not = sqrt(MU./a.^3);       % mean motion (rad/s) </span><br/>               <span style="color: #A0A0A0">  85</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0">  86</span> <span style="color: #228B22; background: #FFFFFF;">% Initialize variables</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold">  87</span> <span style="color: #000000; background: #FFFFFF;">pos = zeros(3,size(t_epoch,2),mm); </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold">  88</span> <span style="color: #000000; background: #FFFFFF;">vel = zeros(3,size(t_epoch,2),mm); </span><br/>               <span style="color: #A0A0A0">  89</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold">  90</span> <span style="color: #000000; background: #FFFFFF;">for time_step = 1:size(t_epoch,2)      % Start loop through each time step </span><br/>               <span style="color: #A0A0A0">  91</span> <span style="color: #228B22; background: #FFFFFF;">	% Compute t_k, elapsed time relative to epoch</span><br/>               <span style="color: #A0A0A0">  92</span> <span style="color: #228B22; background: #FFFFFF;">	% The variable 't' is the current time converted to "seconds of current week"</span><br/>               <span style="color: #A0A0A0">  93</span> <span style="color: #228B22; background: #FFFFFF;">	% The reference time 'toe' is in seconds of current week</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold">  94</span> <span style="color: #000000; background: #FFFFFF;">	t = t_epoch(time_step); </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold">  95</span> <span style="color: #000000; background: #FFFFFF;">	t_k = t - toe;   </span><br/>               <span style="color: #A0A0A0">  96</span> <span style="color: #228B22; background: #FFFFFF;">	</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold">  97</span> <span style="color: #000000; background: #FFFFFF;">	M_k = M_not + (n_not.*t_k);   % mean anomaly at t </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold">  98</span> <a name="Line98"></a><span style="color: #000000; background: #FF8080;">	M_k = rem(M_k,2*pi);          % Make 0&lt;=M_k&lt;=360 </span><br/>               <span style="color: #A0A0A0">  99</span> <span style="color: #228B22; background: #FFFFFF;">	</span><br/>               <span style="color: #A0A0A0"> 100</span> <span style="color: #228B22; background: #FFFFFF;">	% Iterate to find eccentric anomaly.</span><br/>               <span style="color: #A0A0A0"> 101</span> <span style="color: #228B22; background: #FFFFFF;">	% Use M_k as initial guess for E.</span><br/>               <span style="color: #A0A0A0"> 102</span> <span style="color: #228B22; background: #FFFFFF;">	% All PRNs iterated the same ammount, some may converge earlier</span><br/>               <span style="color: #A0A0A0"> 103</span> <span style="color: #228B22; background: #FFFFFF;">	% than others, but there is no logic to loof for that.</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 104</span> <span style="color: #000000; background: #FFFFFF;">	E = M_k;                      % First guess for E </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 105</span> <span style="color: #000000; background: #FFFFFF;">	E_old = E+1;                  % Set E-old for at least one loop </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 106</span> <span style="color: #000000; background: #FFFFFF;">	while sum(abs(E - E_old) &gt;= 0.0000000005) &gt; 0 </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">     24 </span><span style="color: #000000; font-weight: bold"> 107</span> <span style="color: #000000; background: #FFFFFF;">      E_old = E; </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">     24 </span><span style="color: #000000; font-weight: bold"> 108</span> <a name="Line108"></a><span style="color: #000000; background: #FFFFFF;">      E = M_k + (ecc.*sin(E_old)); </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">     24 </span><span style="color: #000000; font-weight: bold"> 109</span> <a name="Line109"></a><span style="color: #000000; background: #FFFFFF;">	end </span><br/>               <span style="color: #A0A0A0"> 110</span> <span style="color: #228B22; background: #FFFFFF;">	</span><br/>               <span style="color: #A0A0A0"> 111</span> <span style="color: #228B22; background: #FFFFFF;">	% true anomaly as a function of eccentric anomaly</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 112</span> <span style="color: #000000; background: #FFFFFF;">	v = atan2(((sqrt(1 - ecc.^2)).*sin(E)),(cos(E) - ecc)); </span><br/>               <span style="color: #A0A0A0"> 113</span> <span style="color: #228B22; background: #FFFFFF;">	</span><br/>               <span style="color: #A0A0A0"> 114</span> <span style="color: #228B22; background: #FFFFFF;">	% For [x,y,z] in the ECEF, 'frame' makes 'rotate' the Earth's rotation rate.  </span><br/>               <span style="color: #A0A0A0"> 115</span> <span style="color: #228B22; background: #FFFFFF;">	% For [x,y,x] in ECI, 'frame' makes 'rotate' equal zero.</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 116</span> <span style="color: #000000; background: #FFFFFF;">	rotate = EARTH_RATE*frame; </span><br/>               <span style="color: #A0A0A0"> 117</span> <span style="color: #228B22; background: #FFFFFF;">	</span><br/>               <span style="color: #A0A0A0"> 118</span> <span style="color: #228B22; background: #FFFFFF;">	% adjusted longitude of ascending node</span><br/>               <span style="color: #A0A0A0"> 119</span> <span style="color: #228B22; background: #FFFFFF;">	% OMEGA_not and OMEGA_dot from almanac</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 120</span> <span style="color: #000000; background: #FFFFFF;">	OMEGA = OMEGA_not + ((OMEGA_dot-rotate).*t_k) - (rotate.*toe); </span><br/>               <span style="color: #A0A0A0"> 121</span> <span style="color: #228B22; background: #FFFFFF;">	</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 122</span> <span style="color: #000000; background: #FFFFFF;">	phi = v + arg_peri;		      % argument of latitude </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 123</span> <span style="color: #000000; background: #FFFFFF;">	R = a.*(1 - ecc.*cos(E));		% radius to satellite </span><br/>               <span style="color: #A0A0A0"> 124</span> <span style="color: #228B22; background: #FFFFFF;">	</span><br/>               <span style="color: #A0A0A0"> 125</span> <span style="color: #228B22; background: #FFFFFF;">	% satellite position</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 126</span> <span style="color: #000000; background: #FFFFFF;">	x = R.*((cos(OMEGA).*cos(phi)) - (sin(OMEGA).*sin(phi).*cos(inc))); </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 127</span> <span style="color: #000000; background: #FFFFFF;">	y = R.*((sin(OMEGA).*cos(phi)) + (cos(OMEGA).*sin(phi).*cos(inc))); </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 128</span> <span style="color: #000000; background: #FFFFFF;">	z = R.*sin(inc).*sin(phi); </span><br/>               <span style="color: #A0A0A0"> 129</span> <span style="color: #228B22; background: #FFFFFF;">	</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 130</span> <span style="color: #000000; background: #FFFFFF;">	p = a.*(1-ecc.^2);			   % parameter </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 131</span> <span style="color: #000000; background: #FFFFFF;">	h = sqrt(MU*p);				   % specific angular momentum </span><br/>               <span style="color: #A0A0A0"> 132</span> <span style="color: #228B22; background: #FFFFFF;">	</span><br/>               <span style="color: #A0A0A0"> 133</span> <span style="color: #228B22; background: #FFFFFF;">	% satellite velocity</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 134</span> <span style="color: #000000; background: #FFFFFF;">	vx = (h./R).*((x.*ecc.*sin(v))./p - (cos(OMEGA).*sin(phi) + sin(OMEGA).*cos(phi).*cos(inc))); </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 135</span> <span style="color: #000000; background: #FFFFFF;">	vy = (h./R).*((y.*ecc.*sin(v))./p - (sin(OMEGA).*sin(phi) - cos(OMEGA).*cos(phi).*cos(inc))); </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 136</span> <span style="color: #000000; background: #FFFFFF;">	vz = (h./R).*((z.*ecc.*sin(v))./p + sin(inc).*cos(phi)); </span><br/>               <span style="color: #A0A0A0"> 137</span> <span style="color: #228B22; background: #FFFFFF;">	</span><br/>               <span style="color: #A0A0A0"> 138</span> <span style="color: #228B22; background: #FFFFFF;">	% Save position and velocity info for each satellite at this </span><br/>               <span style="color: #A0A0A0"> 139</span> <span style="color: #228B22; background: #FFFFFF;">	% time step (3xmm).  Each column corresponds to one PRN. </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 140</span> <span style="color: #000000; background: #FFFFFF;">	sat_pos = [x';y';z']; </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 141</span> <span style="color: #000000; background: #FFFFFF;">	sat_vel_int = [vx';vy';vz']; </span><br/>               <span style="color: #A0A0A0"> 142</span> <span style="color: #228B22; background: #FFFFFF;">	</span><br/>               <span style="color: #A0A0A0"> 143</span> <span style="color: #228B22; background: #FFFFFF;">	% Must subtract (EARTH_RATE X R) term from ECF velocity</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 144</span> <span style="color: #000000; background: #FFFFFF;">	if frame % (if ECF) </span><br/>               <span style="color: #A0A0A0"> 145</span> <span style="color: #228B22; background: #FFFFFF;">      % Compute EARTH_RATE cross R in the ECF frame</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 146</span> <a name="Line146"></a><span style="color: #000000; background: #FF8080;">      o_cross_r = <a href="file46.html">cross</a>([0 0 EARTH_RATE]'*ones(1,mm),sat_pos); </span><br/>               <span style="color: #A0A0A0"> 147</span> <span style="color: #228B22; background: #FFFFFF;">      % convert from ECI to ECEF velocity by subtracting the omega cross r term</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 148</span> <span style="color: #000000; background: #FFFFFF;">      sat_vel = sat_vel_int - o_cross_r; </span><br/>               <span style="color: #A0A0A0"> 149</span> <span style="color: #228B22; background: #FFFFFF;">	else</span><br/>               <span style="color: #A0A0A0"> 150</span> <span style="color: #A0A0A0; background: #FFFFFF;">      sat_vel = sat_vel_int;</span><br/>               <span style="color: #A0A0A0"> 151</span> <span style="color: #A0A0A0; background: #FFFFFF;">	end</span><br/>               <span style="color: #A0A0A0"> 152</span> <span style="color: #228B22; background: #FFFFFF;">     </span><br/>               <span style="color: #A0A0A0"> 153</span> <span style="color: #228B22; background: #FFFFFF;">	% Reshape such that each column contains all info for all PRNs at </span><br/>               <span style="color: #A0A0A0"> 154</span> <span style="color: #228B22; background: #FFFFFF;">	% one time step.  First 3 rows=PRN1, second 3 rows=PRN2, ...        start 3,mm</span><br/>               <span style="color: #A0A0A0"> 155</span> <span style="color: #228B22; background: #FFFFFF;">	% pos(i,:)=[x1,x2,x3,x4,...,znn</span><br/>               <span style="color: #A0A0A0"> 156</span> <span style="color: #228B22; background: #FFFFFF;">	%           y1,y2,y3,y4,...,ynn</span><br/>               <span style="color: #A0A0A0"> 157</span> <span style="color: #228B22; background: #FFFFFF;">	%           z1,z2,z3,z4,...,znn</span><br/>               <span style="color: #A0A0A0"> 158</span> <span style="color: #228B22; background: #FFFFFF;">	%           x1,x2,x3,x4,...,xnn]</span><br/>               <span style="color: #A0A0A0"> 159</span> <span style="color: #228B22; background: #FFFFFF;">	% vel ... same format</span><br/>               <span style="color: #A0A0A0"> 160</span> <span style="color: #228B22; background: #FFFFFF;">	% final matrices are ((3*mm),size(t_epoch,2))</span><br/>               <span style="color: #A0A0A0"> 161</span> <span style="color: #228B22; background: #FFFFFF;">	%pos(:,time_step)=[reshape(sat_pos,mm*3,1)];</span><br/>               <span style="color: #A0A0A0"> 162</span> <span style="color: #228B22; background: #FFFFFF;">	%vel(:,time_step)=[reshape(sat_vel,mm*3,1)];</span><br/>               <span style="color: #A0A0A0"> 163</span> <span style="color: #228B22; background: #FFFFFF;">	</span><br/>               <span style="color: #A0A0A0"> 164</span> <span style="color: #228B22; background: #FFFFFF;">	% Data saved in 3D arrays</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 165</span> <span style="color: #000000; background: #FFFFFF;">	pos(:,time_step,:) = sat_pos; </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 166</span> <span style="color: #000000; background: #FFFFFF;">	vel(:,time_step,:) = sat_vel; </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 167</span> <a name="Line167"></a><span style="color: #000000; background: #FF8080;">end % (time_step) </span><br/></pre></body></html>